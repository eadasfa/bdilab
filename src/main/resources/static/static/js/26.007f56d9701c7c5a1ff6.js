webpackJsonp([26],{TxIL:function(e,t,a){"use strict";a.d(t,"a",function(){return n});var n={ADMIN:"系统管理员",COMPANY_ADMIN:"单位管理员",DEPART_ADMIN:"部门管理员",PROJECT_ADMIN:"项目管理员",USER:"普通用户"}},V7pf:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("orNh"),r=a("mUNK"),o=a("VU/8"),i=o(n.a,r.a,null,null,null);t.default=i.exports},mUNK:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:4}},[a("el-input",{attrs:{placeholder:"用户昵称"},model:{value:e.searchForm.nickname,callback:function(t){e.$set(e.searchForm,"nickname",t)},expression:"searchForm.nickname"}})],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-input",{attrs:{placeholder:"单位名称"},model:{value:e.searchForm.companyName,callback:function(t){e.$set(e.searchForm,"companyName",t)},expression:"searchForm.companyName"}})],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-input",{attrs:{placeholder:"联系人"},model:{value:e.searchForm.connector,callback:function(t){e.$set(e.searchForm,"connector",t)},expression:"searchForm.connector"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{icon:"el-icon-search",loading:e.loading},on:{click:e.query}},[e._v("搜索")])],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleCreate}},[e._v("添加")])],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{type:"warning",icon:"el-icon-download"},on:{click:e.handleDownload}},[e._v("导出")])],1)],1),e._v(" "),a("el-table",{staticStyle:{"margin-top":"20px"},attrs:{border:"",fit:"","highlight-current-row":"",data:e.users,"element-loading-text":"加载中..."}},[a("el-table-column",{attrs:{align:"center",label:"序号",width:"60",type:"index"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"50px",align:"center",label:"用户名"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.username))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"50px",align:"center",label:"昵称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.nickname))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"110px",align:"center",label:"单位名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.company&&t.row.company.companyName?t.row.company.companyName:""))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"110px",align:"center",label:"部门名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.depart&&t.row.depart.departName?t.row.depart.departName:""))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"110px",align:"center",label:"权限角色"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.ROLE_MAP[""+t.row.roleManager]))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"110px",align:"center",label:"联系人"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.connector))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"110px",align:"center",label:"联系电话"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.telephone))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"100px",align:"center",label:"注册日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.createTime||e.dateTimeFormat))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"80",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){e.handleUpdate(t.row)}}},[a("i",{staticClass:"el-icon-edit"})]),e._v(" "),a("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(a){e.handleDelete(t.row)}}},[a("i",{staticClass:"el-icon-delete"})])]}}])})],1),e._v(" "),a("el-pagination",{staticStyle:{margin:"20px 0"},attrs:{"current-page":e.usersPagination.number,"page-size":e.usersPagination.size,total:e.usersPagination.totalElements,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handlePaginationSizeChange,"current-change":e.handleCurrentPageChange}}),e._v(" "),a("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"userForm",staticClass:"small-space",staticStyle:{width:"400px","margin-left":"50px"},attrs:{model:e.formData,"label-position":"right","label-width":"110px"}},[a("el-form-item",{attrs:{label:"用户名",prop:"username",rules:[{required:!0,message:"用户名不能为空"}]}},[a("el-input",{model:{value:e.formData.username,callback:function(t){e.$set(e.formData,"username",t)},expression:"formData.username"}})],1),e._v(" "),"create"===e.dialogStatus?a("el-form-item",{attrs:{label:"密码",prop:"password",rules:[{required:!0,message:"密码不能为空"}]}},[a("el-input",{attrs:{type:"password"},model:{value:e.formData.password,callback:function(t){e.$set(e.formData,"password",t)},expression:"formData.password"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"昵称",prop:"nickname",rules:[{required:!0,message:"昵称不能为空"}]}},[a("el-input",{model:{value:e.formData.nickname,callback:function(t){e.$set(e.formData,"nickname",t)},expression:"formData.nickname"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"单位",prop:"companyId",rules:[{required:!0,message:"单位名称不能为空"}]}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:e.isDisabledCompany,placeholder:"请选择单位"},on:{change:e.handleCompanyChange},model:{value:e.formData.company.id,callback:function(t){e.$set(e.formData.company,"id",t)},expression:"formData.company.id"}},e._l(e.companyOption,function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.companyName}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"部门",prop:"departId",rules:[{required:!0,message:"部门名称不能为空"}]}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:e.isDisabledDepart,placeholder:"请选择"},on:{change:e.handleDepartChange},model:{value:e.formData.depart.id,callback:function(t){e.$set(e.formData.depart,"id",t)},expression:"formData.depart.id"}},e._l(e.departOption,function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.departName}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"角色权限",prop:"roleManager",rules:[{required:!0,message:"角色权限不能为空"}]}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.formData.roleManager,callback:function(t){e.$set(e.formData,"roleManager",t)},expression:"formData.roleManager"}},e._l(e.cloneROLEMAP,function(e,t){return a("el-option",{key:t,attrs:{value:t,label:e}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"联系人",prop:"connector",rules:[{required:!0,message:"联系人不能为空"}]}},[a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.formData.connector,callback:function(t){e.$set(e.formData,"connector",t)},expression:"formData.connector"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系电话",prop:"telephone",rules:[{required:!0,message:"联系电话不能为空"}]}},[a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.formData.telephone,callback:function(t){e.$set(e.formData,"telephone",t)},expression:"formData.telephone"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),e._v(" "),"create"==e.dialogStatus?a("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.create}},[e._v("确定")]):a("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.update}},[e._v("确定")])],1)],1)],1)},r=[],o={render:n,staticRenderFns:r};t.a=o},orNh:function(e,t,a){"use strict";var n=a("Dd8w"),r=a.n(n),o=a("NYxO"),i=a("0xDb"),l=a("TxIL"),s={id:0,username:"",password:"",nickname:"",connector:"",company:{},companyId:"",departId:"",depart:{},telephone:"",roleManager:"",roles:["ADMIN"],createTime:(new Date).getTime()},c={page:0,size:20,sort:"id,desc",companyName:"",nickname:"",connector:""};t.a={data:function(){return{loading:!1,dialogFormVisible:!1,departOption:[],companyOption:[],ROLE_MAP:l.a,dialogStatus:"",isDisabledCompany:!1,isDisabledDepart:!1,cloneROLEMAP:a.i(i.c)(l.a),textMap:{update:"编辑",create:"创建"},formData:a.i(i.c)(s),searchForm:a.i(i.c)(c)}},computed:r()({},a.i(o.b)(["users","usersPagination","loginUser","departs","companys"])),mounted:function(){this.query(),this.queryAllCompanys(),this.queryAllDeparts()},methods:r()({},a.i(o.c)(["queryAllUsers","queryAllDeparts","queryAllCompanys","createUser","updateUser","deleteUser"]),{query:function(){var e=this;this.loading=!0,this.queryAllUsers(this.searchForm).then(function(){e.loading=!1}).catch(function(t){e.loading=!1})},handleCreate:function(){this.formData=a.i(i.c)(s),this.dialogStatus="create",this.dialogFormVisible=!0,this.handleFormDataValue(),this.companyOption=this.companys},handleUpdate:function(e){var t=this;this.formData=a.i(i.c)(e),this.dialogStatus="update",this.dialogFormVisible=!0,this.formData.companyId=this.formData.company.id,this.formData.departId=this.formData.depart.id,this.handleFormDataValue(),this.companyOption=this.companys,this.departOption=this.departs.filter(function(e){return e.companyId===t.formData.companyId})},handleFormDataValue:function(){var e=this,t=this.loginUser,a=this.loginUser.roleManager;a===this.formData.roleManager&&"update"===this.dialogStatus?"ADMIN"!==a&&(this.isDisabledCompany=!0,this.formData.company.id=t.company.id,this.formData.companyId=this.formData.company.id,this.departOption=this.departs.filter(function(t){return t.companyId===e.formData.companyId}),this.queryAllDeparts(t.company.id),delete this.cloneROLEMAP.ADMIN,"COMPANY_ADMIN"!==a&&(this.isDisabledDepart=!0,this.formData.depart.id=t.depart.id,this.formData.departId=this.formData.depart.id,delete this.cloneROLEMAP.COMPANY_ADMIN,"DEPART_ADMIN"!==a&&(delete this.cloneROLEMAP.DEPART_ADMIN,"PROJECT_ADMIN"!==a&&delete this.cloneROLEMAP.PROJECT_ADMIN))):"ADMIN"!==a&&(this.isDisabledCompany=!0,this.formData.company.id=t.company.id,this.formData.companyId=this.formData.company.id,this.departOption=this.departs.filter(function(t){return t.companyId===e.formData.companyId}),this.queryAllDeparts(t.company.id),delete this.cloneROLEMAP.ADMIN,delete this.cloneROLEMAP.COMPANY_ADMIN,"COMPANY_ADMIN"!==a&&(this.isDisabledDepart=!0,this.formData.depart.id=t.depart.id,this.formData.departId=this.formData.depart.id,delete this.cloneROLEMAP.DEPART_ADMIN,"DEPART_ADMIN"!==a&&delete this.cloneROLEMAP.PROJECT_ADMIN))},handleDelete:function(e){var t=this;this.$confirm("确定删除此用户吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"error"}).then(function(){t.deleteUser(e).then(function(){a.i(i.d)(),t.query()}).catch(function(e){a.i(i.d)("",{type:"error"})})}).catch(function(){})},handleCompanyNameChange:function(){var e=this;this.formData.departId="",this.queryAllDeparts(this.formData).then(function(){e.loading=!1}).catch(function(t){e.loading=!1})},handleDepartChange:function(){this.formData.departId=this.formData.depart.id},handleCompanyChange:function(){var e=this;this.formData.companyId=this.formData.company.id,this.formData.depart={},this.formData.departId="",this.departOption=this.departs.filter(function(t){return t.companyId===e.formData.companyId})},create:function(){var e=this,t=this.formData,n=t.id,r=t.username,o=t.password,l=t.nickname,s=t.connector,c=t.company,d=t.depart,p=t.telephone,m=t.roleManager,u=t.roles,h=t.createTime,f={id:n,username:r,password:o,nickname:l,connector:s,companyId:c.id,departId:d.id,telephone:p,roleManager:m,roles:u,createTime:h};this.$refs.userForm.validate(function(t){t&&(e.loading=!0,e.createUser(f).then(function(){e.dialogFormVisible=!1,e.loading=!1,a.i(i.d)(),e.query()}).catch(function(t){a.i(i.d)("",{type:"error"}),e.loading=!1}))})},update:function(){var e=this;this.$refs.userForm.validate(function(t){t&&(e.loading=!0,e.updateUser(e.formData).then(function(){e.dialogFormVisible=!1,a.i(i.d)(),e.query(),e.loading=!1}).catch(function(t){a.i(i.d)("",{type:"error"}),e.loading=!1}))})},handlePaginationSizeChange:function(e){this.searchForm.size=e,this.query()},handleCurrentPageChange:function(e){this.searchForm.page=e-1,this.query()},handleDownload:function(){var e=this;Promise.all([a.e(36),a.e(35)]).then(function(){(0,a("zWO4").export_json_to_excel)(["序号","用户名","单位名称","部门名称","权限角色","联系人","联系电话","注册日期"],e.formatJson(),"用户管理数据")}.bind(null,a)).catch(a.oe)},formatJson:function(){return this.users.map(function(e){var t=e.id,n=e.username,r=e.companyName,o=e.departName,l=e.roleManager,s=e.connector,c=e.telephone,d=e.createTime;return[t,n,r,o,l,s,c,a.i(i.a)(d)]})}})}}});