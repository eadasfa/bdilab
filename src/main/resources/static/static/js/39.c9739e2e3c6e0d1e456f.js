webpackJsonp([39],{FNuE:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("woOf"),n=a.n(o),i=a("ZoQJ"),c=["星期一","星期二","星期三","星期四","星期五","星期六","星期日"],l=["1","3","5","7"],r={discountAmount:[{required:!0,message:"请输入优惠券金额",trigger:"blur"}],couponEffectiveDay:[{required:!0,message:"请输入领券后天数",trigger:"blur"}],reachAmount:[{required:!0,message:"请输入使用条件",trigger:"blur"}]},s=["08:00:00-10:00:00","10:00:00-12:00:00","12:00:00-14:00:00","14:00:00-16:00:00","16:00:00-18:00:00","18:00:00-20:00:00"],u={couponName:"",discountAmount:"",reachAmount:"",couponEffectiveDay:"",available:"",couponRemindTimes:"",couponAdvanceRemindTime:"",couponEffectivePeriod:"",couponState:1,couponNote:""},m={data:function(){return{checkAll:!1,checkedWeek:["星期一","星期二","星期三","星期四","星期五","星期六","星期日"],checkedRemindersNum:[],weekOptions:c,remindersNumOptions:l,isInline:!0,isIndeterminate:!0,currentDialogVisible:!1,superDialogVisible:!1,payDialogVisible:!1,detailDialogVisible:!1,dialogStatus:"create",total:0,activeValue:1,inactiveValue:0,merchant:"测试商户",timeOptions:s,formData:Object(i.b)(u),dialogTitleMap:{update:"修改优惠券",create:"新增优惠券"},formInline:{couponName:"",pageSize:10,current:1},rules:r,tableData:[]}},mounted:function(){this.query(),this.merchant=localStorage.merchant_name},methods:{query:function(){var e=this,t=localStorage.selectedShop;this.$axios.get("/couponTactics/getCouponTacticsByPage?id="+t,{params:this.formInline}).then(function(t){var a=t.records;e.tableData=a,e.total=t.total}).catch(function(e){})},handleCheckAllChange:function(e){this.checkedWeek=e?c:[],this.isIndeterminate=!1},handleCheckedWeekChange:function(e){var t=e.length;this.checkAll=t===this.weekOptions.length,this.isIndeterminate=t>0&&t<this.weekOptions.length},handleCurrentChange:function(e){this.formInline.current=e,this.query()},handleBlur:function(){var e=this.formData.discountAmount;this.formData.couponName=e+"元优惠券"},onAddOrUpdateOpen:function(e,t){var a=this;if(this.dialogStatus=e,"create"===e){this.currentDialogVisible=!0;this.formData=Object(i.b)({couponName:"",discountAmount:"",reachAmount:"",couponEffectiveDay:"",available:"",couponRemindTimes:"",couponAdvanceRemindTime:"",couponEffectivePeriod:"",couponState:1,couponNote:""})}else if("update"===e){var o=t.couponEffectivePeriod,c=t.couponRemindTimes,l=t.couponState,r=t.couponID;if(1===l)return void this.$notify.warning({title:"警告",message:"需要修改优惠券则先停止使用"});if(this.$axios.get("couponTactics/judgeCouponTactics/"+r).then(function(e){2===e.code?a.$notify.warning({title:"警告",message:"该优惠券正在活动策略中使用，修改之前请先停止活动策略"}):a.currentDialogVisible=!0}).catch(function(e){}),o){var s=o.split(",");s[0]&&(this.checkedWeek=s)}if(c){var u=c.split(",");u[0]&&(this.checkedRemindersNum=u)}this.formData=n()({},t)}},onDetailClick:function(e){this.detailDialogVisible=!0;var t=e.couponEffectivePeriod,a=e.couponRemindTimes;if(t){var o=t.split(",");o[0]&&(this.checkedWeek=o)}if(a){var i=a.split(",");i[0]&&(this.checkedRemindersNum=i)}this.formData=n()({},e)},handleCancel:function(){this.currentDialogVisible=!1,this.checkedWeek=[],this.checkedRemindersNum=[]},onDeleteClick:function(e){var t=this,a=e.couponState,o=e.couponID;1!==a?this.$axios.get("couponTactics/judgeCouponTactics/"+o).then(function(a){2===a.code?t.$notify.warning({title:"警告",message:"该优惠券正在活动策略中使用，删除之前请先停止活动策略"}):t.$confirm("此操作将永久删除该内容, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$axios.get("/couponTactics/deleteCouponTacticsById?id="+e.couponID).then(function(e){0===e.code?(t.$notify.success({title:"成功",message:e.message}),t.query()):t.$notify.error({title:"失败",message:e.message})}).catch(function(e){})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})}).catch(function(e){}):this.$notify.warning({title:"警告",message:"需要删除优惠券则先停止使用"})},handleAdd:function(e){var t=this,a=this.formData,o=this.checkedWeek,n=this.checkedRemindersNum;this.$refs[e].validate(function(e){if(e){var i=localStorage.selectedShop;t.formData.couponEffectivePeriod=o.join(","),t.formData.couponRemindTimes=n.join(","),t.formData.discountAmount=parseInt(a.discountAmount),t.$axios.post("/couponTactics/addCouponTactics?id="+i,a).then(function(e){0===e.code?(t.$notify.success({title:"成功",message:e.Mes}),t.currentDialogVisible=!1,t.checkedWeek=[],t.checkedRemindersNum=[],t.query()):t.$notify.error({title:"失败",message:e.Mes})}).catch(function(e){console.log("error",e)})}})},resetForm:function(e){this.$refs[e].resetFields()},hanleUpdate:function(e){var t=this;this.$refs[e].validate(function(e){if(e){t.formData;var a=t.checkedWeek,o=t.checkedRemindersNum;t.formData.couponEffectivePeriod=a.join(","),t.formData.couponRemindTimes=o.join(","),t.$axios.post("/couponTactics/updateCouponTactics",t.formData).then(function(e){0===e.code?(t.$notify.success({title:"成功",message:e.Mes}),t.currentDialogVisible=!1,t.checkedWeek=[],t.checkedRemindersNum=[],t.query()):t.$notify.error({title:"失败",message:e.Mes})}).catch(function(e){console.log("error",e)})}})},handleStatusChange:function(e){var t=this;this.$axios.post("/couponTactics/updateCouponTactics",e).then(function(e){if(0===e.code)t.$notify.success({title:"成功",message:"操作成功"}),t.query();else{t.$notify.error({title:"失败",message:"操作失败"});var a=t.inactiveValue;t.inactiveValue=t.activeValue,t.activeValue=a,t.query()}}).catch(function(e){t.query(),console.log("error",e)})}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[a("el-button",{staticClass:"right",attrs:{type:"primary",icon:"add"},on:{click:function(t){e.onAddOrUpdateOpen("create")}}},[e._v("添加")]),e._v(" "),a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline}},[a("el-form-item",{attrs:{label:"优惠券名称"}},[a("el-input",{attrs:{placeholder:"请输入优惠券名称"},model:{value:e.formInline.couponName,callback:function(t){e.$set(e.formInline,"couponName",t)},expression:"formInline.couponName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.query}},[e._v("查询")])],1)],1)],1),e._v(" "),a("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{width:50,fixed:"",type:"index",label:"序号",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.$index+10*(e.formInline.current-1)+1))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"couponName",label:"优惠券名称",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"discountAmount",label:"优惠券金额",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"reachAmount",label:"使用条件",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"couponState",label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(0===t.row.couponState?"停用":"使用")+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"状态管理",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":e.activeValue,"inactive-value":e.inactiveValue,"active-text":"使用","inactive-text":"停止","active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(a){e.handleStatusChange(t.row)}},model:{value:t.row.couponState,callback:function(a){e.$set(t.row,"couponState",a)},expression:"scope.row.couponState"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){e.onAddOrUpdateOpen("update",t.row)}}},[a("i",{staticClass:"el-icon-edit"},[e._v("修改")])]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){e.onDeleteClick(t.row)}}},[a("i",{staticClass:"el-icon-delete"},[e._v("删除")])]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){e.onDetailClick(t.row)}}},[a("i",{staticClass:"el-icon-edit"},[e._v("详情")])])]}}])})],1),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"","current-page":e.formInline.current,layout:"prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.$set(e.formInline,"current",t)}}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitleMap[e.dialogStatus],visible:e.currentDialogVisible},on:{"update:visible":function(t){e.currentDialogVisible=t}}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:22}},[a("el-form",{ref:"formData",attrs:{model:e.formData,rules:e.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"商家名称:",prop:"merchant"}},[a("el-input",{attrs:{disabled:""},model:{value:e.merchant,callback:function(t){e.merchant=t},expression:"merchant"}}),a("br")],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠券名称:",prop:"couponName"}},[a("el-input",{attrs:{disabled:""},model:{value:e.formData.couponName,callback:function(t){e.$set(e.formData,"couponName",t)},expression:"formData.couponName"}}),a("br")],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠券金额:",prop:"discountAmount"}},[a("el-input",{on:{blur:e.handleBlur},model:{value:e.formData.discountAmount,callback:function(t){e.$set(e.formData,"discountAmount",t)},expression:"formData.discountAmount"}}),a("br")],1),e._v(" "),a("el-form-item",{attrs:{label:"使用条件:",prop:"reachAmount"}},[a("el-input",{attrs:{placeholder:"请输入消费多少钱可用此券，建议人均消费*2"},model:{value:e.formData.reachAmount,callback:function(t){e.$set(e.formData,"reachAmount",t)},expression:"formData.reachAmount"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"领券后有效天数:",prop:"couponEffectiveDay"}},[a("el-input",{attrs:{placeholder:"从领券之日起算，多少天内次券有效"},model:{value:e.formData.couponEffectiveDay,callback:function(t){e.$set(e.formData,"couponEffectiveDay",t)},expression:"formData.couponEffectiveDay"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠当天可用:",prop:"available"}},[a("el-input",{attrs:{placeholder:"0，表示当天可用，N, 表示N天后可用"},model:{value:e.formData.available,callback:function(t){e.$set(e.formData,"available",t)},expression:"formData.available"}},[a("template",{slot:"append"},[e._v("  参考值：0  ")])],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠券提醒次数:",prop:"couponRemindTimes"}},[a("el-checkbox-group",{model:{value:e.checkedRemindersNum,callback:function(t){e.checkedRemindersNum=t},expression:"checkedRemindersNum"}},e._l(e.remindersNumOptions,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t))])})),e._v(" "),a("span",{staticClass:"tips"},[e._v("\n              到期几天提醒，最多3次，例如：1,3,5；表示到期前5天，3天，1天提醒\n            ")])],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠券提醒时间:",prop:"couponAdvanceRemindTime"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.formData.couponAdvanceRemindTime,callback:function(t){e.$set(e.formData,"couponAdvanceRemindTime",t)},expression:"formData.couponAdvanceRemindTime"}},e._l(e.timeOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),a("br"),e._v(" "),a("span",{staticClass:"tips"},[e._v("\n              在5天，3天，1天的哪个时间段提醒。"),a("br"),e._v("\n              例如：16:00 ~ 18:00.表示此时间段的随机时间将提醒消费者。\n            ")])],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠券使用时间:",prop:"couponEffectivePeriod"}},[[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("\n                全选\n              ")]),e._v(" "),a("div",{staticStyle:{margin:"15px 0"}}),e._v(" "),a("el-checkbox-group",{on:{change:e.handleCheckedWeekChange},model:{value:e.checkedWeek,callback:function(t){e.checkedWeek=t},expression:"checkedWeek"}},e._l(e.weekOptions,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v("\n                  "+e._s(t)+"\n                ")])}))]],2),e._v(" "),a("el-form-item",{attrs:{label:"优惠券备注:",prop:"couponNote"}},[a("el-input",{model:{value:e.formData.couponNote,callback:function(t){e.$set(e.formData,"couponNote",t)},expression:"formData.couponNote"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"margin-left":"120px"}},[a("el-button",{on:{click:e.handleCancel}},[e._v("取消")]),e._v(" "),"create"==e.dialogStatus?a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleAdd("formData")}}},[e._v("确定")]):a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.hanleUpdate("formData")}}},[e._v("确定")])],1)],1)],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"详情",visible:e.detailDialogVisible},on:{"update:visible":function(t){e.detailDialogVisible=t}}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:22}},[a("el-form",{ref:"formData",attrs:{model:e.formData,inline:!0,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"商家名称:",prop:"merchant"}},[a("el-input",{attrs:{disabled:""},model:{value:e.merchant,callback:function(t){e.merchant=t},expression:"merchant"}}),a("br")],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠券名称:",prop:"couponName"}},[a("el-input",{attrs:{disabled:""},model:{value:e.formData.couponName,callback:function(t){e.$set(e.formData,"couponName",t)},expression:"formData.couponName"}}),a("br")],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠券金额:",prop:"discountAmount"}},[a("el-input",{attrs:{disabled:""},model:{value:e.formData.discountAmount,callback:function(t){e.$set(e.formData,"discountAmount",t)},expression:"formData.discountAmount"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"使用条件:",prop:"reachAmount"}},[a("el-input",{attrs:{disabled:""},model:{value:e.formData.reachAmount,callback:function(t){e.$set(e.formData,"reachAmount",t)},expression:"formData.reachAmount"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"领券后有效天数:",prop:"couponEffectiveDay"}},[a("el-input",{attrs:{disabled:"",placeholder:""},model:{value:e.formData.couponEffectiveDay,callback:function(t){e.$set(e.formData,"couponEffectiveDay",t)},expression:"formData.couponEffectiveDay"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠当天可用:",prop:"available"}},[a("el-input",{attrs:{placeholder:"",disabled:""},model:{value:e.formData.available,callback:function(t){e.$set(e.formData,"available",t)},expression:"formData.available"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠券提醒时间:",prop:"couponAdvanceRemindTime"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"",disabled:""},model:{value:e.formData.couponAdvanceRemindTime,callback:function(t){e.$set(e.formData,"couponAdvanceRemindTime",t)},expression:"formData.couponAdvanceRemindTime"}},e._l(e.timeOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}))],1),a("br"),e._v(" "),a("el-form-item",{attrs:{label:"优惠券提醒次数:",prop:"couponRemindTimes"}},[a("el-checkbox-group",{attrs:{disabled:""},model:{value:e.checkedRemindersNum,callback:function(t){e.checkedRemindersNum=t},expression:"checkedRemindersNum"}},e._l(e.remindersNumOptions,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v("\n                "+e._s(t)+"\n              ")])}))],1),a("br"),e._v(" "),a("el-form-item",{attrs:{label:"优惠券使用时间:",prop:"couponEffectivePeriod"}},[[a("el-checkbox-group",{attrs:{disabled:""},on:{change:e.handleCheckedWeekChange},model:{value:e.checkedWeek,callback:function(t){e.checkedWeek=t},expression:"checkedWeek"}},e._l(e.weekOptions,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v("\n                  "+e._s(t)+"\n                ")])}))]],2),e._v(" "),a("el-form-item",{attrs:{label:"优惠券备注:",prop:"couponNote"}},[a("el-input",{attrs:{disabled:""},model:{value:e.formData.couponNote,callback:function(t){e.$set(e.formData,"couponNote",t)},expression:"formData.couponNote"}})],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var p=a("VU/8")(m,d,!1,function(e){a("iaP+")},"data-v-5a4413c9",null);t.default=p.exports},"iaP+":function(e,t){}});