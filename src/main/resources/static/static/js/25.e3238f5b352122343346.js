webpackJsonp([25],{"2vrF":function(e,t,r){t=e.exports=r("FZ+f")(!1),t.push([e.i,".el-tooltip__popper{max-width:40vw!important}",""])},EkFj:function(e,t,r){"use strict";function i(e){r("RvX8")}Object.defineProperty(t,"__esModule",{value:!0});var a=r("XhH4"),n=r("VO9X"),o=r("VU/8"),l=i,s=o(a.a,n.a,l,null,null);t.default=s.exports},RvX8:function(e,t,r){var i=r("2vrF");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);r("rjj0")("f0ca2b68",i,!0)},VO9X:function(e,t,r){"use strict";var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:6}},[r("el-input",{attrs:{placeholder:"桥梁名称"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.query(t)}},model:{value:e.searchForm.bridgeName,callback:function(t){e.$set(e.searchForm,"bridgeName",t)},expression:"searchForm.bridgeName"}})],1),e._v(" "),r("el-col",{attrs:{span:10}},[r("el-button",{attrs:{loading:e.loading,icon:"el-icon-search"},on:{click:e.query}},[e._v("搜索")]),e._v(" "),r("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleCreate}},[e._v("添加")]),e._v(" "),r("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"warning",icon:"el-icon-download"},on:{click:e.handleDownload}},[e._v("导出excel")])],1)],1),e._v(" "),r("el-table",{attrs:{data:e.project.children,"element-loading-text":"拼命加载中",border:"",fit:"","highlight-current-row":""}},[r("el-table-column",{attrs:{align:"center",label:"序号",width:"80",type:"index"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"桥梁编号",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.bridgeId)+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"桥梁名称","min-width":"130",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.bridgeName)+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"桥梁编码","min-width":"95",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.bridgeNo)+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"桥梁位置","min-width":"95",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.bridgeLocation)+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"桥梁概况","min-width":"95",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tooltip",{attrs:{content:t.row.bridgeOverview}},[r("span",[e._v(e._s(e._f("cutLargeText")(t.row.bridgeOverview,20)))])])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tag",{attrs:{type:"已完成"===t.row.bridgeStatus?"success":"danger"}},[e._v("\n          "+e._s(t.row.bridgeStatus)+"\n        ")])]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text"},on:{click:function(r){e.handleUpdate(t.row)}}},[r("i",{staticClass:"el-icon-edit"})]),e._v(" "),r("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(r){e.openHandleDelete(t.row)}}},[r("i",{staticClass:"el-icon-delete"})])]}}])})],1),e._v(" "),r("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[r("el-form",{ref:"bridgeForm",staticClass:"small-space",staticStyle:{width:"400px","margin-left":"50px"},attrs:{model:e.formData,"label-position":"right","label-width":"120px"}},[r("el-form-item",{attrs:{label:"桥梁名称",prop:"bridgeName",rules:[{required:!0,message:"桥梁名称不能为空"}]}},[r("el-input",{model:{value:e.formData.bridgeName,callback:function(t){e.$set(e.formData,"bridgeName",t)},expression:"formData.bridgeName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"桥梁编码",prop:"bridgeNo",rules:[{required:!0,message:"桥梁编码不能为空"}]}},[r("el-input",{model:{value:e.formData.bridgeNo,callback:function(t){e.$set(e.formData,"bridgeNo",t)},expression:"formData.bridgeNo"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"桥梁编号",prop:"bridgeId",rules:[{required:!0,message:"桥梁编号不能为空"}]}},[r("el-input",{attrs:{disabled:""},model:{value:e.formData.bridgeId,callback:function(t){e.$set(e.formData,"bridgeId",t)},expression:"formData.bridgeId"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"状态",prop:"bridgeStatus",rules:[{required:!0,message:"状态不能为空"}]}},[r("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:e.formData.bridgeStatus,callback:function(t){e.$set(e.formData,"bridgeStatus",t)},expression:"formData.bridgeStatus"}},e._l(e.bridgeStatusOptions,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.label}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"桥梁位置",prop:"bridgeLocation",rules:[{required:!1,message:"桥梁位置不能为空"}]}},[r("el-input",{model:{value:e.formData.bridgeLocation,callback:function(t){e.$set(e.formData,"bridgeLocation",t)},expression:"formData.bridgeLocation"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"桥梁经度",prop:"bridgeLat",rules:[{required:!1,message:"桥梁经度不能为空"}]}},[r("el-input",{attrs:{type:"number"},model:{value:e.formData.bridgeLat,callback:function(t){e.$set(e.formData,"bridgeLat",t)},expression:"formData.bridgeLat"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"桥梁纬度",prop:"bridgeLng",rules:[{required:!1,message:"桥梁纬度不能为空"}]}},[r("el-input",{attrs:{type:"number"},model:{value:e.formData.bridgeLng,callback:function(t){e.$set(e.formData,"bridgeLng",t)},expression:"formData.bridgeLng"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"桥梁概况",prop:"bridgeOverview",rules:[{required:!1,message:"桥梁简介不能为空"}]}},[r("el-input",{attrs:{type:"textarea",row:4},model:{value:e.formData.bridgeOverview,callback:function(t){e.$set(e.formData,"bridgeOverview",t)},expression:"formData.bridgeOverview"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),e._v(" "),"create"==e.dialogStatus?r("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.create}},[e._v("确定")]):r("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.update}},[e._v("确定")])],1)],1)],1)},a=[],n={render:i,staticRenderFns:a};t.a=n},XhH4:function(e,t,r){"use strict";var i=r("Dd8w"),a=r.n(i),n=r("NYxO"),o=r("0xDb"),l={id:0,bridgeName:"",bridgeNo:"",bridgeId:"U001P001B001",bridgeStatus:"未完成",bridgeLocation:"",bridgeLng:0,bridgeLat:0},s={page:0,size:999,projection:"inline",bridgeName:""};t.a={data:function(){return{loading:!1,dialogFormVisible:!1,dialogStatus:"",searchForm:r.i(o.l)(s),textMap:{update:"编辑",create:"创建"},formData:r.i(o.l)(l),bridgeStatusOptions:[{value:"未完成",label:"未完成"},{value:"已完成",label:"已完成"}],project:{}}},computed:a()({},r.i(n.b)(["selectedProject","menus","loginUser"])),mounted:function(){this.selectedProject&&this.selectedProject.id&&(this.project=this.selectedProject)},watch:{menus:function(){var e=this.$route.query.id,t=this.menus.filter(function(t){return t.id===parseInt(e)});t.length&&(this.project=t[0])}},methods:a()({},r.i(n.c)(["createBridge","updateBridge","deleteBridge","queryAllBridges","createAdminIdentity","createStructuralTechnology","createConstructTree","createDailyInspection","createOftenInspection","createPeriodInspection","createSpecialInspection"]),{query:function(){var e=this;this.loading=!0,this.queryAllBridges(this.searchForm).then(function(){e.loading=!1}).catch(function(t){console.log(t),e.loading=!1})},handleCreate:function(){this.formData=r.i(o.l)(l);try{var e=this.project.projectNo,t=this.project.children.length;this.formData.bridgeId=e+"B"+r.i(o.q)(t+1)}catch(e){}this.dialogStatus="create",this.dialogFormVisible=!0},handleUpdate:function(e){this.formData=r.i(o.l)(e),this.dialogStatus="update",this.dialogFormVisible=!0},openHandleDelete:function(e){var t=this;this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(function(){t.deleteBridge(e).then(function(){r.i(o.d)(),t.query()}).catch(function(i){if(i&&i.response&&i.response.status){if(409===i.response.status){var n=a()({},r.i(o.l)(e),{project:"projects/"+e.project.id});t.formData=n,t.update(!0)}}r.i(o.d)("",{type:"error"})})}).catch(function(){r.i(o.d)("已取消删除",{type:"info"})})},create:function(){var e=this;this.$refs.bridgeForm.validate(function(t){if(t){e.loading=!0;var i={bridge:e.formData,project:e.project,user:e.loginUser};e.createBridge(i).then(function(t){return e.createAdminIdentity({bridge:t})}).then(function(t){return e.createStructuralTechnology({bridge:t})}).then(function(t){return e.createConstructTree({bridge:t})}).then(function(t){return e.createDailyInspection({bridge:t})}).then(function(t){return e.createOftenInspection({bridge:t})}).then(function(t){return e.createPeriodInspection({bridge:t})}).then(function(t){return e.createSpecialInspection({bridge:t})}).then(function(){r.i(o.d)(),e.dialogFormVisible=!1,e.loading=!1,e.query()}).catch(function(t){r.i(o.d)("",{type:"error"}),e.loading=!1})}})},update:function(e){var t=this;this.loading=!0,this.$refs.bridgeForm.validate(function(i){i&&t.updateBridge(t.formData).then(function(){t.dialogFormVisible=!1,t.loading=!1,e||r.i(o.d)(),t.query()}).catch(function(i){e||r.i(o.d)("",{type:"error"}),t.loading=!1})})},handleDownload:function(){var e=this;this.$confirm("您确定要导出Excel吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){e.exportExcel(),r.i(o.d)("已成功导出Excel!")}).catch(function(){r.i(o.d)("已取消",{type:"info"})})},exportExcel:function(){var e=this;Promise.all([r.e(36),r.e(35)]).then(function(){var t=r("zWO4"),i=t.export_json_to_excel,a=["序号","项目名称","桥梁名称","桥梁编号编号","项目状态"],n=["id","projectName","bridgeName","bridgeNo","bridgeStatus"];i(a,r.i(o.h)(n,e.$store.state.menus.menus[e.$route.query.id-1].children),"项目信息")}.bind(null,r)).catch(r.oe)}})}}});