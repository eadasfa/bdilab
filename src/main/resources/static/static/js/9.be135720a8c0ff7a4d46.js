webpackJsonp([9],{"/HS0":function(e,t,n){var i=n("L7K6");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n("rjj0")("6b054f93",i,!0)},"2SeO":function(e,t,n){"use strict";function i(e){n("/HS0")}Object.defineProperty(t,"__esModule",{value:!0});var a=n("viYe"),r=n("wbHw"),o=n("VU/8"),s=i,c=o(a.a,r.a,s,"data-v-0e26d0f8",null);t.default=c.exports},L7K6:function(e,t,n){t=e.exports=n("FZ+f")(!1),t.push([e.i,".select-loading[data-v-0e26d0f8]{-webkit-box-shadow:0 0 15px 2px #000;box-shadow:0 0 15px 2px #000;border-radius:5px}",""])},dvzJ:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=[{value:"m"},{value:"m²"},{value:"m³"},{value:"t"},{value:"个"},{value:"根"},{value:"套"},{value:"处"},{value:"块"},{value:"天"},{value:"接头"}]},viYe:function(e,t,n){"use strict";var i=n("Gu7T"),a=n.n(i),r=n("Dd8w"),o=n.n(r),s=n("NYxO"),c=n("0xDb"),l=n("dvzJ");t.a={data:function(){return{loading:!1,bridge:{},constructTreeData:[],selectedUnit:"主桥单元",selectedCheckItem:"当前检查结果",approachBridgeUnit:[],tableDiseasesData:[],engineeringUnitOptions:l.a,currentChooseResult:[],currentOperateRow:{},maintenanceTableData:[],maintenanceTableRowMap:{}}},computed:o()({},n.i(s.b)(["constructTree","menus","selectedBridge","periodDiseases","periodHistoryCheckDiseases","constructTreeMainBridgeType","diseases","periodHistoryDiseases"])),mounted:function(){if(!this.$route.query.id&&!this.selectedBridge.id)return void n.i(c.d)("未选择桥梁，无法进行操作！",{type:"error"});this.selectedBridge.id&&(this.bridge=this.selectedBridge,this.query())},watch:{constructTree:function(){var e=this.constructTree,t=e.main,i=e.approaches;this.constructTreeData=n.i(c.c)(t),this.approachBridgeUnit=i.map(function(e,t){return{value:"引桥单元N"+(t+1)}})},menus:function(){var e=this;if(!this.bridge.id){var t=this.$route.query.id;this.menus.forEach(function(n){var i=n.children.filter(function(e){return e.id===parseInt(t)});i.length&&(e.bridge=i[0],e.selectBridge(e.bridge),e.query())})}}},methods:o()({},n.i(s.c)(["selectBridge","queryConstructTree","queryPeriodInspection","queryPeriodDiseases","updatePeriodDisease","queryDiseases","queryPeriodHistoryDiseases","queryPeriodHistoryCheckDisease"]),{query:function(){var e=this;this.loading=!0,this.queryConstructTree(this.bridge).then(function(){return e.queryPeriodInspection(e.bridge)}).then(function(){return e.queryPeriodDiseases()}).then(function(){return e.filterDiseases()}).then(function(){return e.createMaintenanceTableData()}).catch(function(e){console.log(e)}).then(function(){e.loading=!1})},handleChangeUnit:function(){var e=this.constructTree,t=e.main,i=e.approaches,a=this.selectedUnit;if("主桥单元"===a)this.constructTreeData=n.i(c.c)(t);else{var r=parseInt(a.replace("引桥单元N",""))-1;this.constructTreeData=n.i(c.c)(i[r])}this.filterDiseases(),this.createMaintenanceTableData()},handleChangeCheckItem:function(e){var t=this;e&&("当前检查结果"===e?this.query():this.queryPeriodHistoryCheckDisease({id:e}).then(function(){t.filterDiseases(),t.createMaintenanceTableData()}).catch(function(e){n.i(c.d)("查询历史结果病害列表失败",{type:"error"})}))},filterDiseases:function(e){var t=this.selectedUnit,n="M-";if(t){var i=t||"主桥单元";n="M-",0===i.indexOf("引桥单元")&&(n=i.replace("引桥单元","")+"-")}else e&&(n=e);"当前检查结果"===this.selectedCheckItem?this.tableDiseasesData=this.periodDiseases.filter(function(e){return e.componentNo&&0===e.componentNo.indexOf(n)}):this.tableDiseasesData=this.periodHistoryCheckDiseases.filter(function(e){return e.componentNo&&0===e.componentNo.indexOf(n)})},createMaintenanceTableData:function(){var e=this,t=this.tableDiseasesData;this.maintenanceTableData=[];var i={0:[],1:[],2:[],3:[],4:[]};this.maintenanceTableRowMap=i,t&&t.length&&this.constructTreeData.forEach(function(a){var r=0;a.children.forEach(function(o){var s=0;o.children.forEach(function(r){var l=0,u=function(s){var u=0,d=s.id,p=s.label,h=t.filter(function(e){return e.componentNo===d}),f={};h.forEach(function(e){var t=e.diseaseType;void 0===f[t]?f[t]=[e]:f[t].push(e)});for(var g in f){var v=f[g];v.forEach(function(t){var i=t.id,s=t.diseaseType,l=t.diseaseLocation,u=t.defectNum,d=t.maintenanceMeasure,h=t.engineeringQuantity,f=t.engineeringUnit,g=t.unitPrice,v={id:i,partOfName:a.label,partName:o.label,bigComponentName:n.i(c.m)(r.id)?r.label:"/",componentName:p,diseaseType:s,diseaseLocation:l,defectNum:u,maintenanceMeasure:d,engineeringQuantity:h,engineeringUnit:f,unitPrice:g,operation:"view",bigMeasures:[]};e.maintenanceTableData.push(v)});var m=v.length;u+=m,m&&i[4].push(m)}u&&i[3].push(u),l+=u};n.i(c.m)(r.id)?r.children.forEach(u):[r].forEach(u),s+=l,l&&i[2].push(l)}),r+=s,s&&i[1].push(s)}),r&&i[0].push(r)})},spanMaintenance:function(e){var t=(e.row,e.column,e.rowIndex),i=e.columnIndex;if(i>=0&&i<5)return n.i(c.k)(t,this.maintenanceTableRowMap[i])},handleRowEdit:function(e){var t=this;e.operation="edit";var i=this.constructTreeMainBridgeType,r=e.partOfName,o=e.partName,s=e.diseaseType,l={bridgeType:i,partOf:r,part:o,diseaseType:s,page:0,size:100};this.loading=!0,this.queryDiseases(l).then(function(){var n=t.diseases;if(n&&n.length){var i=[];n.forEach(function(e){var t=e.maintenance;try{var n=JSON.parse(t);i.push.apply(i,a()(n))}catch(e){console.log(e)}}),e.bigMeasures=i}}).catch(function(e){console.log(e),n.i(c.d)("查询构件病害养护维修措施数据库失败！",{type:"error"})}).then(function(){t.loading=!1})},handleRowSave:function(e){var t=this,i=e.id,a=e.maintenanceMeasure,r=e.engineeringQuantity,o=e.engineeringUnit,s=e.unitPrice;if(i){this.loading=!0;var l={id:i,maintenanceMeasure:a,engineeringQuantity:r,engineeringUnit:o,unitPrice:s};this.updatePeriodDisease(l).then(function(){e.operation="view",n.i(c.d)()}).catch(function(e){console.log(e),n.i(c.d)("",{type:"error"})}).then(function(){t.loading=!1})}},handleMeasureClick:function(e,t){e.engineeringUnit=t.engineeringUnit,e.unitPrice=t.unitPrice}})}},wbHw:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-tabs",{attrs:{type:"border-card"}},[n("el-tab-pane",{attrs:{label:"养护维修措施"}},[n("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:24}},[n("el-col",{attrs:{span:4}},[n("el-select",{staticStyle:{width:"100%"},on:{change:e.handleChangeUnit},model:{value:e.selectedUnit,callback:function(t){e.selectedUnit=t},expression:"selectedUnit"}},[n("el-option",{attrs:{value:"主桥单元"}},[e._v("主桥单元")]),e._v(" "),e._l(e.approachBridgeUnit,function(t){return n("el-option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.value))])})],2)],1),e._v(" "),n("el-col",{attrs:{span:4}},[n("el-select",{staticStyle:{width:"100%"},on:{change:e.handleChangeCheckItem},model:{value:e.selectedCheckItem,callback:function(t){e.selectedCheckItem=t},expression:"selectedCheckItem"}},[n("el-option",{attrs:{value:"当前检查结果"}},[e._v("当前检查结果")]),e._v(" "),e._l(e.periodHistoryDiseases,function(t){return n("el-option",{key:t.id,attrs:{value:t.id}},[e._v("历史检查结果: "+e._s(t.checkDate)+" ("+e._s(t.checkUnit)+")")])})],2)],1),e._v(" "),n("el-col",{attrs:{span:4}},[n("el-button",{attrs:{icon:"el-icon-search",loading:e.loading},on:{click:e.query}},[e._v("搜索")])],1)],1),e._v(" "),n("el-table",{staticStyle:{width:"100% margin: 10px"},attrs:{"show-overflow-tooltip":"","highlight-current-row":"",data:e.maintenanceTableData,"span-method":e.spanMaintenance,border:""}},[n("el-table-column",{attrs:{align:"center",prop:"partOfName",label:"部位","min-width":"80"}},[e._v("部位")]),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"partName",label:"部件名称","min-width":"100"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"bigComponentName",label:"构件大类","min-width":"100"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"componentName",label:"构件名称","min-width":"100"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"diseaseType",label:"病害类型","min-width":"100"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"diseaseLocation",label:"位置","min-width":"80"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"defectNum",label:"缺损数量","min-width":"80"}}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"maintenanceMeasure",label:"养护维修措施","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(t){return["view"===t.row.operation?n("span",[e._v(e._s(t.row.maintenanceMeasure))]):n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择","collapse-tags":"",filterable:"","allow-create":""},model:{value:t.row.maintenanceMeasure,callback:function(n){e.$set(t.row,"maintenanceMeasure",n)},expression:"scope.row.maintenanceMeasure"}},e._l(t.row.bigMeasures,function(i){return n("el-option-group",{key:i.name,attrs:{label:i.name}},e._l(i.measures,function(i){return n("el-option",{key:i.name,attrs:{label:i.name,value:i.name},nativeOn:{click:function(n){e.handleMeasureClick(t.row,i)}}})}))}))]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"engineeringQuantity",label:"工程量","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return["view"===t.row.operation?n("span",[e._v(e._s(t.row.engineeringQuantity))]):n("el-input",{model:{value:t.row.engineeringQuantity,callback:function(n){e.$set(t.row,"engineeringQuantity",n)},expression:"scope.row.engineeringQuantity"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",prop:"engineeringUnit",label:"单位","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return["view"===t.row.operation?n("span",[e._v(e._s(t.row.engineeringUnit))]):n("el-select",{attrs:{placeholder:"请选择",filterable:"","allow-create":""},model:{value:t.row.engineeringUnit,callback:function(n){e.$set(t.row,"engineeringUnit",n)},expression:"scope.row.engineeringUnit"}},e._l(e.engineeringUnitOptions,function(e){return n("el-option",{key:e.value,attrs:{value:e.value}})}))]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"操作",width:"90",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return["view"===t.row.operation?n("el-button",{attrs:{size:"mini",type:"warning",loading:e.loading},on:{click:function(n){e.handleRowEdit(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),"edit"===t.row.operation?n("el-button",{attrs:{size:"mini",type:"success",loading:e.loading},on:{click:function(n){e.handleRowSave(t.row)}}},[e._v("保存")]):e._e()]}}])})],1)],1)],1)],1)},a=[],r={render:i,staticRenderFns:a};t.a=r}});