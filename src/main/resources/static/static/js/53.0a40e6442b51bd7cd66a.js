webpackJsonp([53],{Zhx9:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("woOf"),n=o.n(a),l=o("ZoQJ"),i={couponEffectiveDay:[{required:!0,message:"请输入领券后天数",trigger:"blur"}],reachAmount:[{required:!0,message:"请输入使用条件",trigger:"blur"}]},r={couponBagID:"",couponBagName:"",couponBagNote:"",rId:"",couponAndNumList:[]},c={rId:null,couponTacticsId:null,couponFlag:1},s=[{value:!1,label:"否"},{value:!0,label:"是"}],u={data:function(){return{merchantCouponOptions:[],selectedCouponList:[],currentDialogVisible:!1,publishDialog:!1,dialogStatus:"create",total:0,options:s,activeValue:1,discountAmount:"",inactiveValue:0,merchant:"测试商户",formData:Object(l.b)(r),publishForm:Object(l.b)(c),detailFormData:{},detailDialogVisible:!1,dialogTitleMap:{update:"修改优惠券包",create:"新增优惠券包"},formInline:{couponBagName:"",pageSize:10,current:1},rules:i,tableData:[]}},mounted:function(){this.query(),this.queryMerchantCoupon(),this.merchant=localStorage.merchant_name},methods:{query:function(){var e=this,t=localStorage.selectedShop;this.publishForm.rId=t,this.$axios.get("couponTacticsBag/getCouponTacticsBagByPage?rId="+t,{params:this.formInline}).then(function(t){var o=t.records;e.tableData=o,e.total=t.total}).catch(function(e){})},handleCurrentChange:function(e){this.formInline.current=e,this.query()},handleBlur:function(){var e=this.discountAmount;this.formData.couponBagName=e+"元优惠券包"},queryMerchantCoupon:function(){var e=this,t=localStorage.selectedShop;this.$axios.get("/couponTactics/getCouponTactics?id="+t).then(function(t){var o=t.records;e.merchantCouponOptions=o}).catch(function(e){})},handleReturnSelect:function(e,t){var o=this,a=this.selectedCouponList;this.formData.couponAndNumList=[],a.map(function(e){var t=o.merchantCouponOptions.filter(function(t){return t.couponID===e})[0],a={couponId:t.couponID,couponName:t.couponName,num:1};o.formData.couponAndNumList.push(a)})},onDetailOpen:function(e){this.detailDialogVisible=!0,this.detailFormData=Object(l.b)(e)},onAddOrUpdateOpen:function(e,t){var o=this;if(this.dialogStatus=e,"create"===e)this.currentDialogVisible=!0,this.selectedCouponList=[],this.formData=Object(l.b)(r);else if("update"===e){if(0!==t.isPublic)return void Object(l.e)("该状态下无法修改",{type:"warning"});this.currentDialogVisible=!0;var a=t.couponAndNumList;this.selectedCouponList=[],a&&a.map(function(e){var t=e.couponId;o.selectedCouponList.push(t)}),this.formData=n()({},t)}},handleCancel:function(){this.currentDialogVisible=!1},onDeleteClick:function(e){var t=this;0===e.isPublic?this.$confirm("此操作将永久删除该内容, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$axios.get("/couponTacticsBag/deleteCouponTacticsBagById?couponBagID="+e.couponBagID).then(function(e){0===e.code?(t.$notify.success({title:"成功",message:e.message}),t.query()):t.$notify.error({title:"失败",message:e.message})}).catch(function(e){})}).catch(function(){t.$message({type:"info",message:"已取消删除"})}):Object(l.e)("该状态下无法修改",{type:"warning"})},handleAdd:function(e){var t=this,o=this.formData;this.$refs[e].validate(function(e){if(e){var a=localStorage.selectedShop;t.formData.rId=a,t.$axios.post("/couponTacticsBag/addCouponTacticsBag",o).then(function(e){0===e.code?(t.$notify.success({title:"成功",message:e.Mes}),t.currentDialogVisible=!1,t.selectedCouponList=[],t.query()):t.$notify.error({title:"失败",message:e.Mes})}).catch(function(e){console.log("error",e)})}})},resetForm:function(e){this.$refs[e].resetFields()},handleStatusChange:function(e){var t=this;e.rId=localStorage.selectedShop,this.$axios.post("/couponTacticsBag/addCouponTacticsBag",e).then(function(e){if(0===e.code)t.$notify.success({title:"成功",message:"操作成功"}),t.query();else{t.$notify.error({title:"失败",message:"操作失败"});var o=t.inactiveValue;t.inactiveValue=t.activeValue,t.activeValue=o,t.query()}}).catch(function(e){t.query(),console.log("error",e)})},onPublishClick:function(e){0===e.isPublic&&0!==e.couponBagState?(this.publishForm.couponTacticsId=e.couponBagID,this.publishForm.couponBagName=e.couponBagName,this.publishDialog=!0):Object(l.e)("该状态下无法发布",{type:"warning"})},handlePublish:function(){var e=this;delete this.publishForm.couponBagName,this.$axios.post("/publishCoupon/publishCouponToCommon",this.publishForm).then(function(t){if(0===t.code)e.$notify.success({title:"成功",message:"操作成功"}),e.query(),e.publishDialog=!1;else{e.$notify.error({title:"失败",message:"操作失败"});var o=e.inactiveValue;e.inactiveValue=e.activeValue,e.activeValue=o,e.query()}}).catch(function(t){e.query(),console.log("error",t)})}}},p={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"container"},[o("div",{staticClass:"handle-box"},[o("el-button",{staticClass:"right",attrs:{type:"primary",icon:"add"},on:{click:function(t){e.onAddOrUpdateOpen("create")}}},[e._v("\n        添加\n      ")]),e._v(" "),o("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline}},[o("el-form-item",{attrs:{label:"优惠券包名称"}},[o("el-input",{attrs:{placeholder:"请输入优惠券包名称"},model:{value:e.formInline.couponBagName,callback:function(t){e.$set(e.formInline,"couponBagName",t)},expression:"formInline.couponBagName"}})],1),e._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:e.query}},[e._v("查询")])],1)],1)],1),e._v(" "),o("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:e.tableData,border:""}},[o("el-table-column",{attrs:{width:50,fixed:"",type:"index",label:"序号",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(t.$index+10*(e.formInline.current-1)+1))])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"couponBagName",label:"优惠券包名称",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"couponAndNumList",label:"优惠券包",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(t.row.couponAndNumList?t.row.couponAndNumList.map(function(e){return e.couponName}).join(";"):""))])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"isPublic",label:"发布",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(2===t.row.isPublic?"已发布":1===t.row.isPublic?"审核中":"未发布")+"\n        ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"状态",width:"280",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-switch",{attrs:{"active-value":e.activeValue,"inactive-value":e.inactiveValue,"active-text":"使用","inactive-text":"停止","active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:t.row.couponBagState,callback:function(o){e.$set(t.row,"couponBagState",o)},expression:"scope.row.couponBagState"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"操作",width:"230",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text"},on:{click:function(o){e.onDetailOpen(t.row)}}},[o("i",{staticClass:"el-icon-add"},[e._v("详情")])]),e._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(o){e.onAddOrUpdateOpen("update",t.row)}}},[o("i",{staticClass:"el-icon-edit"},[e._v("修改")])]),e._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(o){e.onDeleteClick(t.row)}}},[o("i",{staticClass:"el-icon-delete"},[e._v("删除")])]),e._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(o){e.onPublishClick(t.row)}}},[e._v("\n            发布\n          ")])]}}])})],1),e._v(" "),o("div",{staticClass:"pagination"},[o("el-pagination",{attrs:{background:"","current-page":e.formInline.current,layout:"prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.$set(e.formInline,"current",t)}}})],1)],1),e._v(" "),o("el-dialog",{attrs:{title:e.dialogTitleMap[e.dialogStatus],visible:e.currentDialogVisible},on:{"update:visible":function(t){e.currentDialogVisible=t}}},[o("el-row",{attrs:{gutter:24}},[o("el-col",{attrs:{span:22}},[o("el-form",{ref:"formData",attrs:{model:e.formData,rules:e.rules,"label-width":"150px"}},[o("el-form-item",{attrs:{label:"商家名称:",prop:"merchant"}},[o("el-input",{attrs:{disabled:""},model:{value:e.merchant,callback:function(t){e.merchant=t},expression:"merchant"}}),o("br")],1),e._v(" "),o("el-form-item",{attrs:{label:"优惠券包名称:",prop:"couponBagName"}},[o("el-input",{attrs:{disabled:""},model:{value:e.formData.couponBagName,callback:function(t){e.$set(e.formData,"couponBagName",t)},expression:"formData.couponBagName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"使用条件:",prop:"discountAmount"}},[o("el-input",{on:{blur:e.handleBlur},model:{value:e.discountAmount,callback:function(t){e.discountAmount=t},expression:"discountAmount"}}),o("br")],1),e._v(" "),o("el-form-item",{attrs:{label:"返券选择:",prop:"couponName"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择"},on:{change:function(t){e.handleReturnSelect()}},model:{value:e.selectedCouponList,callback:function(t){e.selectedCouponList=t},expression:"selectedCouponList"}},e._l(e.merchantCouponOptions,function(e){return o("el-option",{key:e.couponID,attrs:{label:e.couponName,value:e.couponID}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"返券列表:",prop:"couponAndNumList"}},[e._l(e.formData.couponAndNumList,function(t){return o("el-row",{key:t.couponId,attrs:{span:24}},[o("span",[e._v(e._s(t.couponName)+": ")]),e._v(" "),o("el-input-number",{attrs:{min:1,max:20,label:"请选择"},model:{value:t.num,callback:function(o){e.$set(t,"num",o)},expression:"item.num"}})],1)})],2),e._v(" "),o("el-form-item",{attrs:{label:"优惠券备注:",prop:"couponBagNote"}},[o("el-input",{model:{value:e.formData.couponBagNote,callback:function(t){e.$set(e.formData,"couponBagNote",t)},expression:"formData.couponBagNote"}})],1),e._v(" "),o("el-form-item",{staticStyle:{"margin-left":"120px"}},[o("el-button",{on:{click:e.handleCancel}},[e._v("取消")]),e._v(" "),(e.dialogStatus,o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleAdd("formData")}}},[e._v("\n              确定\n            ")]))],1)],1)],1)],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"详情",width:"500px",visible:e.detailDialogVisible},on:{"update:visible":function(t){e.detailDialogVisible=t}}},[o("el-row",{attrs:{gutter:24}},[o("el-col",{attrs:{span:22}},[o("el-form",{ref:"detailFormData",attrs:{model:e.detailFormData,"label-width":"150px"}},[o("el-form-item",{attrs:{label:"商家名称:",prop:"merchant"}},[o("el-input",{attrs:{disabled:""},model:{value:e.merchant,callback:function(t){e.merchant=t},expression:"merchant"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"优惠券包名称:",prop:"couponBagName"}},[o("el-input",{attrs:{disabled:""},model:{value:e.detailFormData.couponBagName,callback:function(t){e.$set(e.detailFormData,"couponBagName",t)},expression:"detailFormData.couponBagName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"优惠券包:",prop:"couponAndNumList"}},[[o("span",[e._v(e._s(e.detailFormData.couponAndNumList?e.detailFormData.couponAndNumList.map(function(e){return e.couponName+"("+e.num+"张)"}).join(";"):""))])]],2)],1)],1)],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"发布",visible:e.publishDialog},on:{"update:visible":function(t){e.publishDialog=t}}},[o("el-row",{attrs:{gutter:24}},[o("el-col",{attrs:{span:22}},[o("el-form",{ref:"as",attrs:{model:e.publishForm,"label-width":"150px"}},[o("el-form-item",{attrs:{label:"发布优惠券"}},[o("el-input",{attrs:{disabled:""},model:{value:e.publishForm.couponBagName,callback:function(t){e.$set(e.publishForm,"couponBagName",t)},expression:"publishForm.couponBagName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"是否同一区域",prop:"sameLocation"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.publishForm.sameLocation,callback:function(t){e.$set(e.publishForm,"sameLocation",t)},expression:"publishForm.sameLocation"}},e._l(e.options,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"距离",prop:"distance"}},[o("el-input",{model:{value:e.publishForm.distance,callback:function(t){e.$set(e.publishForm,"distance",t)},expression:"publishForm.distance"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"区域",prop:"location"}},[o("el-input",{model:{value:e.publishForm.location,callback:function(t){e.$set(e.publishForm,"location",t)},expression:"publishForm.location"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"发布数量",prop:"amount"}},[o("el-input",{model:{value:e.publishForm.amount,callback:function(t){e.$set(e.publishForm,"amount",t)},expression:"publishForm.amount"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"发布单价",prop:"price"}},[o("el-input",{model:{value:e.publishForm.price,callback:function(t){e.$set(e.publishForm,"price",t)},expression:"publishForm.price"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"开始时间:",prop:"startDate"}},[[o("el-date-picker",{attrs:{clearable:!1,type:"date",editable:!1,format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"开始时间"},model:{value:e.publishForm.startDate,callback:function(t){e.$set(e.publishForm,"startDate",t)},expression:"publishForm.startDate"}})]],2),e._v(" "),o("el-form-item",{attrs:{label:"结束时间:",prop:"endDate"}},[o("el-date-picker",{attrs:{clearable:!1,type:"date",editable:!1,format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"结束时间"},model:{value:e.publishForm.endDate,callback:function(t){e.$set(e.publishForm,"endDate",t)},expression:"publishForm.endDate"}})],1),e._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handlePublish()}}},[e._v("确 定")])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var m=o("VU/8")(u,p,!1,function(e){o("xUVh")},"data-v-3cd173c8",null);t.default=m.exports},xUVh:function(e,t){}});