webpackJsonp([20],{"35vU":function(e,t,i){var n=i("bxFt");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);i("rjj0")("b87f7216",n,!0)},"5gZx":function(e,t,i){"use strict";var n=i("Dd8w"),a=i.n(n),r=i("NYxO"),o=i("0xDb");t.a={data:function(){return{loading:!1,bridge:{},selectedUnit:"主桥单元",selectedCheckItem:"当前检查结果",bridgeType:"",approachBridgeUnit:[],constructTreeData:[],tableData:[],tableDataMap:{},diseasesRowTotal:0,diseases:[]}},mounted:function(){if(!this.$route.query.id&&!this.selectedBridge.id)return void i.i(o.d)("未选择桥梁，无法进行操作！",{type:"error"});this.selectedBridge.id&&(this.bridge=this.selectedBridge,this.query())},computed:a()({},i.i(r.b)(["selectedBridge","constructTree","menus","constructTreeMainBridgeType","periodDiseases","periodHistoryDiseases","periodHistoryCheckDiseases"])),watch:{constructTree:function(){var e=this.constructTree,t=e.main,n=e.approaches;this.constructTreeData=i.i(o.c)(t),this.approachBridgeUnit=n.map(function(e,t){return{value:"引桥单元N"+(t+1)}})},menus:function(){var e=this;if(!this.bridge.id){var t=this.$route.query.id;this.menus.forEach(function(i){var n=i.children.filter(function(e){return e.id===parseInt(t)});n.length&&(e.bridge=n[0],e.selectBridge(e.bridge),e.query())})}},constructTreeMainBridgeType:function(e){this.bridgeType=e}},methods:a()({},i.i(r.c)(["selectBridge","queryConstructTree","queryPeriodInspection","queryPeriodDiseases","updatePeriodDisease","queryPeriodHistoryDiseases","queryPeriodHistoryCheckDisease"]),{query:function(){var e=this,t=this.bridge;t.id&&this.queryConstructTree(t).then(function(){return e.queryPeriodInspection(t)}).then(function(){return e.queryPeriodDiseases()}).then(function(){e.filterDiseases(),e.createTableData()}).catch(function(e){})},handleChangeUnit:function(){var e=this.constructTree,t=e.main,n=e.approaches,a=e.approachTypes,r=this.selectedUnit,s=null;if("主桥单元"===r)this.constructTreeData=i.i(o.c)(t);else{var c=parseInt(r.replace("引桥单元N",""))-1;s=a[c]||{},this.bridgeType=s.bridgeType,this.constructTreeData=i.i(o.c)(n[c])}this.filterDiseases(),this.createTableData()},handleChangeCheckItem:function(e){var t=this;e&&("当前检查结果"===e?this.query():this.queryPeriodHistoryCheckDisease({id:e}).then(function(){t.filterDiseases(),t.createTableData()}).catch(function(e){i.i(o.d)("查询历史结果病害列表失败",{type:"error"})}))},filterDiseases:function(e){var t=this.selectedUnit,i="M-";if(t){var n=t||"主桥单元";i="M-",0===n.indexOf("引桥单元")&&(i=n.replace("引桥单元","")+"-")}else e&&(i=e);"当前检查结果"===this.selectedCheckItem?this.diseases=this.periodDiseases.filter(function(e){return e.componentNo&&0===e.componentNo.indexOf(i)}):this.diseases=this.periodHistoryCheckDiseases.filter(function(e){return e.componentNo&&0===e.componentNo.indexOf(i)})},createTableData:function(){var e=this;this.tableData=[],this.diseasesRowTotal=0;var t={1:[],2:[]},i=this.diseases;this.constructTreeData.forEach(function(n){var a=n.children,r=0;a.forEach(function(a){var o=0,s=a.id;i.filter(function(e){return 0===e.componentNo.indexOf(s)}).forEach(function(t){var i=t.id,s=t.maintenanceMeasure,c=t.engineeringQuantity,l=t.engineeringUnit,u=t.unitPrice;if(i&&s){var d={id:i,partOf:n.label,part:a.label,maintenanceMeasure:s,engineeringQuantity:c,engineeringUnit:l,unitPrice:u,unitPriceCoefficient:"1.0",operation:"view"};e.computeTotal(d),e.tableData.push(d),o+=1,r+=1,e.diseasesRowTotal+=1}}),o&&t[2].push(o)}),r&&t[1].push(r)}),this.tableDataMap=t;var n=0;this.tableData.forEach(function(e){n+=parseFloat(e.total)});var a={partOf:"费用合计",maintenanceMeasure:n.toFixed(2)};this.tableData.push(a)},spanFormData:function(e){var t=(e.row,e.column,e.rowIndex),n=e.columnIndex,a=this.tableDataMap;return t===this.diseasesRowTotal?0===n?[1,1]:1===n?[1,2]:3===n?[1,7]:[0,0]:1===n||2===n?i.i(o.k)(t,a[n]):void 0},handleRowEdit:function(e){e.operation="edit"},handleRowSave:function(e){var t=this,n=e.id,a=e.unitPriceCoefficient,r={id:n,unitPriceCoefficient:a};n&&(this.loading=!0,this.updatePeriodDisease(r).then(function(){i.i(o.d)(),e.operation="view"}).catch(function(e){console.log(e)}).then(function(){t.loading=!1}))},handleCoefficientChange:function(e){this.computeTotal(e)},computeTotal:function(e){var t=e.engineeringQuantity,n=e.unitPrice,a=e.unitPriceCoefficient;try{var r=parseFloat(t)||0,s=parseFloat(n)||0,c=parseFloat(a)||1;e.total=(r*s*c).toFixed(2)}catch(e){console.log(e),i.i(o.d)("可能输入非法值！",{type:"warning"})}}})}},S76m:function(e,t,i){"use strict";function n(e){i("35vU")}Object.defineProperty(t,"__esModule",{value:!0});var a=i("5gZx"),r=i("YXsD"),o=i("VU/8"),s=n,c=o(a.a,r.a,s,null,null);t.default=c.exports},YXsD:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container",attrs:{type:"border-card"}},[i("el-tabs",{attrs:{type:"border-card"}},[i("el-tab-pane",{attrs:{label:"养护维修费用分析"}},[i("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:24}},[i("el-col",{attrs:{span:3}},[i("el-select",{on:{change:e.handleChangeUnit},model:{value:e.selectedUnit,callback:function(t){e.selectedUnit=t},expression:"selectedUnit"}},[i("el-option",{attrs:{value:"主桥单元"}},[e._v("主桥单元")]),e._v(" "),e._l(e.approachBridgeUnit,function(t){return i("el-option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.value))])})],2)],1),e._v(" "),i("el-col",{attrs:{span:4}},[i("el-select",{staticStyle:{width:"100%"},on:{change:e.handleChangeCheckItem},model:{value:e.selectedCheckItem,callback:function(t){e.selectedCheckItem=t},expression:"selectedCheckItem"}},[i("el-option",{attrs:{value:"当前检查结果"}},[e._v("当前检查结果")]),e._v(" "),e._l(e.periodHistoryDiseases,function(t){return i("el-option",{key:t.id,attrs:{value:t.id}},[e._v("历史检查结果: "+e._s(t.checkDate)+" ("+e._s(t.checkUnit)+")")])})],2)],1),e._v(" "),i("el-col",{attrs:{span:4}},[i("el-button",{attrs:{icon:"el-icon-search",loading:e.loading},on:{click:e.query}},[e._v("搜索")])],1)],1),e._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"span-method":e.spanFormData,border:""}},[i("el-table-column",{attrs:{prop:"data",label:"序号",width:"80",align:"center",type:"index"}}),e._v(" "),i("el-table-column",{attrs:{prop:"partOf",label:"部位","min-width":"90",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"part",label:"部件名称","min-width":"90",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"maintenanceMeasure",label:"养护维修措施","min-width":"100",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"engineeringQuantity",label:"工程量","min-width":"80",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"engineeringUnit",label:"单位","min-width":"75",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"unitPrice",label:"综合单价","min-width":"85",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"unitPriceCoefficient",label:"综合单价调整系数","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["view"===t.row.operation?i("span",[e._v(e._s(t.row.unitPriceCoefficient))]):i("el-input",{on:{change:function(i){e.handleCoefficientChange(t.row)}},model:{value:t.row.unitPriceCoefficient,callback:function(i){e.$set(t.row,"unitPriceCoefficient",i)},expression:"scope.row.unitPriceCoefficient"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"total",label:"小计（元）","min-width":"75",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作",width:"80",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return["view"===t.row.operation?i("el-button",{attrs:{size:"mini",type:"warning",loading:e.loading},on:{click:function(i){e.handleRowEdit(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),"edit"===t.row.operation?i("el-button",{attrs:{size:"mini",type:"success",loading:e.loading},on:{click:function(i){e.handleRowSave(t.row)}}},[e._v("保存")]):e._e()]}}])})],1)],1)],1)],1)},a=[],r={render:n,staticRenderFns:a};t.a=r},bxFt:function(e,t,i){t=e.exports=i("FZ+f")(!1),t.push([e.i,"",""])}});