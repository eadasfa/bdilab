webpackJsonp([14],{DKp4:function(e,t,n){"use strict";var a=n("Dd8w"),r=n.n(a),i=n("NYxO"),o=n("0xDb"),c=n("RZK5"),l={MAIN:"主桥单元",APPROACH:"引桥单元N"},s={bridgeType:"",subBridgeType:"",holesNumber:1};t.a={data:function(){return{isBridgeDeleted:!1,selectedUnitIndex:0,selectedUnitName:l.MAIN,activeTab:"unit",approachBridgeUnit:[],bigComponentNumber:1,bigComponentNumberStart:1,bigComponentTemplate:"",componentType:[],valueComponentType:"",valueComponentNumber:1,componentNumberStart:1,bridge:{},formData:[],loading:!1,selectedNodePath:[],selectedNodePathOfPart:[],selectedNodePathOfBigComponent:[],currentTreeNode:{},bridgeTypes:c.a,dialogFormVisible:!1,approachFormData:n.i(o.c)(s),isBatchAdd:!1,batchAddList:[]}},computed:r()({},n.i(i.b)(["componentTreeData","categoryTreeData","constructTree","constructTreeMainBridgeType","constructTreeMainBridgeHoleNumberStart","menus","selectedBridge"])),mounted:function(){if(!this.$route.query.id&&!this.selectedBridge.id)return void n.i(o.d)("未选择桥梁，无法进行操作！",{type:"error"});this.selectedBridge.id&&(this.bridge=this.selectedBridge,this.query()),window.onbeforeunload=function(e){return!1}},watch:{menus:function(){var e=this;if(!this.bridge.id){var t=this.$route.query.id;this.menus.forEach(function(n){var a=n.children.filter(function(e){return e.id===parseInt(t)});a.length&&(e.bridge=a[0],e.selectBridge(e.bridge),e.query())})}},constructTree:function(){var e=this.constructTree,t=e.main,a=e.approaches,i=e.approachTypes;this.approachBridgeUnit=this.constructTree.approaches.map(function(e,t){var n=i[t];return r()({id:t+1,name:l.APPROACH},n)});try{0===this.selectedUnitIndex?this.formData=n.i(o.c)(t):this.formData=n.i(o.c)(a[this.selectedUnitIndex-1]),this.bigComponentNumberStart=this.constructTreeMainBridgeHoleNumberStart}catch(e){this.selectedUnitIndex=0,this.formData=n.i(o.c)(t)}}},methods:r()({},n.i(i.c)(["selectBridge","queryConstructTree","createConstructTree","updateConstructTree","generateConstructTreeData","generateConstructComponentTreeData"]),{query:function(){var e=this;this.queryConstructTree(this.bridge).then(function(){}).catch(function(t){if(t&&t.response&&t.response.status){switch(t.response.status){case 404:e.createConstructTree({bridge:e.bridge});break;default:console.log(t)}}})},handleSaveData:function(){var e=this;this.loading=!0;var t=this.selectedUnitIndex,a=this.constructTree,r=a.id,i=a.approaches;if(r){var c={id:r};t?(i[t-1]=this.formData,c.approaches=i):c.main=this.formData,this.updateConstructTree(c).then(function(){n.i(o.d)(),e.query(),e.selectedNodePathOfPart=[],e.selectedNodePathOfBigComponent=[]}).catch(function(e){console.log(e),n.i(o.d)("",{type:"error"})}).then(function(){e.loading=!1})}},handleBatchDeleteNode:function(){var e=this,t=this.$refs.componentTree,a=t.getCheckedNodes(!0);if(0===a.length)return void n.i(o.d)("请先选择节点",{type:"warning"});this.$confirm("确定删除选中的 "+a.length+" 节点？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){for(var n=a.length,r=n-1;r>=0;r--){var i=a[r],o=t.getNode(i);e.removeNodeFromTree(i,o)}}).catch(function(e){console.log(e)})},handleBatchAddNode:function(){var e=this.$refs.componentTree,t=e.getCheckedNodes(!0);if(0===t.length)return void n.i(o.d)("请先选择节点",{type:"warning"});for(var a=0,r=[],i=0;i<t.length;i++){var c=t[i],l=c.id,s=c.label;if(n.i(o.m)(l)){var d={id:l,label:s};r.push(d)}else a++}a>0?n.i(o.d)("已选择的结点中有"+a+"个不是构件大类",{type:"warning"}):(this.selectedNodePathOfBigComponent=r,this.isBatchAdd=!0,this.batchAddList=t,this.valueComponentType="",this.generateComponentTreeDataInBatchAdd())},handleUnitClick:function(e){var t=this.constructTree,a=t.main,r=t.approaches,i=t.approachTypes;if(this.selectedUnitIndex=e,this.activeTab="config",this.selectedUnitName=0===e?l.MAIN:""+l.APPROACH+e,e){this.formData=n.i(o.c)(r[e-1]);var c=i[e-1];this.generateComponentTreeData(c),this.bigComponentNumberStart=c.holeNumberStart||1}else this.formData=n.i(o.c)(a),this.generateComponentTreeData({bridgeType:this.constructTreeMainBridgeType}),this.bigComponentNumberStart=this.constructTreeMainBridgeHoleNumberStart},generateComponentTreeData:function(e){this.generateConstructComponentTreeData(e).then(function(){}).catch(function(e){})},renderContent:function(e,t){var a=this,r=t.node,i=t.data,c=(t.store,e("span",[e("span",[e("span",[r.label," (",i.id,")"])]),e("span",{style:"padding-left:15px;"},[e("el-button",{attrs:{type:"text"},style:"color: red;",on:{click:function(){return a.removeNode(i,r)}}},[" 删除"])])])),l=e("span",[e("span",[e("span",[r.label," (",i.id,")"])])]),s=i.id;return n.i(o.e)(s)?l:c},handleBigComponentDone:function(){var e=this.currentTreeNode,t=this.bigComponentNumber,a=e.data;if(a){var r=a.id,i=a.children,c=this.getPartFormatter(r),l=1,s=+this.bigComponentNumberStart||0;if(this.bigComponentTemplate){var d=this.bigComponentTemplate;c=function(e){return d.replace(/[\d]+/,e)}}if(i&&i.length){var p=i[i.length-1].id.split("-");l=+parseInt(p[p.length-1])+1}if(n.i(o.f)(r)){for(var u=[],h=+t,m=0;m<h;m++){var v=c(l+m).replace(/[^\d]*/g,""),f=c(s+m);u.push({id:r+"-"+v,label:f,children:[]})}a.children=a.children.concat(u)}}},handleComponentDone:function(){this.isBatchAdd?this.batchAddComponent():this.noBatchAddComponent()},noBatchAddComponent:function(){var e=this.currentTreeNode,t=this.valueComponentType,a=this.valueComponentNumber,r=e.data;if(r){var i=r.id;r.children||(r.children=[]);for(var c=+this.componentNumberStart||0,l=r.children.length+1,s=[],d=n.i(o.f)(i)?i+"-B":i,p=0,u=parseInt(a);p<u;p++)s.push({id:d+"-"+(l+p),label:t+"-"+(c+p)});r.children=r.children.concat(s)}},batchAddComponent:function(){for(var e=this.batchAddList,t=this.valueComponentType,a=this.valueComponentNumber,r=0;r<e.length;r++){var i=e[r],c=i.id;i.children||(i.children=[]);for(var l=+this.componentNumberStart||0,s=i.children.length+1,d=[],p=n.i(o.f)(c)?c+"-B":c,u=0,h=parseInt(a);u<h;u++)d.push({id:p+"-"+(s+u),label:t+"-"+(l+u)});i.children=i.children.concat(d)}},handleTreeNodeClick:function(e,t){this.isBatchAdd=!1;var a=e.id;if(!n.i(o.e)(a)&&!n.i(o.g)(a)){this.bigComponentTemplate=this.getPartFormatter(a)(0);for(var r=[],i=t;i&&i.id&&!Array.isArray(i.data);)r.unshift(i.data),i=i.parent;n.i(o.f)(r[r.length-1].id)?(this.selectedNodePathOfPart=r,this.selectedNodePathOfBigComponent=[]):n.i(o.m)(r[r.length-1].id)&&(this.selectedNodePathOfBigComponent=r,this.selectedNodePathOfPart=[]),this.selectedNodePath=r,this.currentTreeNode=t,this.generateComponentTypes();try{this.valueComponentType=this.componentType[0].value}catch(e){this.valueComponentType=""}}},getPartFormatter:function(e){var t={P:0,B:1,D:2},n=function(e){return"第"+(e+1)+"跨"};try{var a=e.replace(/^(M|N\d+)-/,""),r=e.match(/[^-]+-(P|B|D)-[^-]/)[1]||"P";this.componentTreeData[t[r]].children.forEach(function(e){e.id===a&&e.formatter&&(n=e.formatter)})}catch(e){console.log(e)}return n},removeNode:function(e,t){var n=this;this.$confirm("是否删除此节点？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){n.removeNodeFromTree(e,t)}).catch(function(e){console.log(e)})},removeNodeFromTree:function(e,t){var a=t.parent.data,r=a.id,i=a.children,c=e.id;if(r){var l=n.i(o.c)(i),s=0;try{var d=parseInt(l[0].id.match(/-(\d+)$/)[1]);s=d-0}catch(e){console.log(e)}var p=l.filter(function(t,n){return t.id!==e.id});if(n.i(o.g)(c)){var u=p.map(function(e,t){var n=e.id,a="-"+(t+1);return e.id=n.replace(/-[\d]+$/,a),e});a.children=u}else if(n.i(o.m)(c)){var h=p.map(function(e,t){var n=e.id,a=e.children,r=t+s;return e.id=n.replace(/-[\d]+$/,"-"+r),e.children=a.map(function(t){var n=t.id.split("-");return t.id=e.id+"-"+n[n.length-1],t}),e});a.children=h}else n.i(o.f)(c),a.children=p}},generateComponentTreeDataInBatchAdd:function(){for(var e=this.batchAddList,t=[],a=0;a<e.length;a++){var r=e[a],i=r.id;this.componentType=[];var c=i;n.i(o.m)(i)?c=i.replace(/^(M|N\d+)-/,"").replace(/-\d+$/,""):n.i(o.f)(i)&&(c=i.replace(/^(M|N\d+)-/,"")),this.getComponentSets(this.componentTreeData,c),this.componentType.forEach(function(e){if(0===t.length){var n={value:e.value};t.push(n)}else{for(var a=0,r=0;r<t.length;r++){var i=t[r];if(e.value===i.value)return void a++}if(!a){var o={value:e.value};t.push(o)}}})}this.componentType=[],this.componentType=t},generateComponentTypes:function(){if(this.selectedNodePath.length){var e=this.currentTreeNode.data,t=e.id;this.componentType=[];var a=t;n.i(o.m)(t)?a=t.replace(/^(M|N\d+)-/,"").replace(/-\d+$/,""):n.i(o.f)(t)&&(a=t.replace(/^(M|N\d+)-/,"")),this.getComponentSets(this.componentTreeData,a)}},getComponentSets:function(e,t){var n=this;Array.isArray(e)&&e.forEach(function(e){if(e.id===t)return void(e.children&&e.children.length?n.componentType=e.children.map(function(e){return{value:e.label}}):n.componentType=[{value:e.label}]);n.getComponentSets(e.children,t)})}})}},I3Az:function(e,t,n){"use strict";function a(e){n("ivMP")}Object.defineProperty(t,"__esModule",{value:!0});var r=n("DKp4"),i=n("s8ng"),o=n("VU/8"),c=a,l=o(r.a,i.a,c,"data-v-c54ff258",null);t.default=l.exports},RZK5:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return r});var a=[{value:"混凝土梁桥"},{value:"钢梁桥"},{value:"钢-混凝土组合梁桥"},{value:"圬工拱桥"},{value:"钢筋混凝土板拱桥"},{value:"钢筋混凝土肋拱桥"},{value:"钢筋混凝土箱拱桥"},{value:"钢筋混凝土双曲拱桥"},{value:"钢筋混凝土刚架拱桥"},{value:"钢筋混凝土桁架拱桥"},{value:"钢-混凝土组合拱桥"},{value:"钢拱桥"},{value:"预应力混凝土加劲梁悬索桥"},{value:"钢桁架加劲梁悬索桥"},{value:"钢箱架加劲梁悬索桥"},{value:"钢-混凝土组合加劲梁悬索桥"},{value:"预应力混凝土主梁斜拉桥"},{value:"钢桁架主梁斜拉桥"},{value:"钢箱架主梁斜拉桥"},{value:"钢-混凝土组合主梁斜拉桥"}],r=[{value:"公路-Ⅰ级",text:"公路-Ⅰ级"},{value:"公路-Ⅱ级",text:"公路-Ⅱ级"},{value:"汽-超20,挂120",text:"汽-超20,挂120"},{value:"汽-20,挂100",text:"汽-20,挂100"},{value:"汽-15",text:"汽-15"},{value:"汽-10",text:"汽-10"}]},ivMP:function(e,t,n){var a=n("ooK1");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);n("rjj0")("2bbb443e",a,!0)},ooK1:function(e,t,n){t=e.exports=n("FZ+f")(!1),t.push([e.i,".box-card[data-v-c54ff258]{margin:10px;max-height:530px;overflow-x:hidden;overflow-y:scroll}.config-card[data-v-c54ff258]{margin-right:50px;margin-top:10px;min-width:400px}.bridge-unit[data-v-c54ff258]{margin:10px;padding:20px}.el-tag[data-v-c54ff258]{margin-left:20px}",""])},s8ng:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[n("el-tab-pane",{attrs:{label:"桥梁单元列表",name:"unit"}},[n("div",{staticClass:"bridge-unit"},[n("div",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleUnitClick(0)}}},[e._v("主桥单元")]),e._v(" "),n("el-tag",{attrs:{type:"info"}},[e._v(e._s(e.constructTreeMainBridgeType))])],1),e._v(" "),e._l(e.approachBridgeUnit,function(t,a){return n("div",{key:t.id,staticStyle:{"margin-left":"60px","margin-top":"30px"}},[n("el-button",{attrs:{type:"warning"},on:{click:function(t){e.handleUnitClick(a+1)}}},[e._v("\n            "+e._s(t.name+t.id)+"\n          ")]),e._v(" "),n("el-tag",{attrs:{type:"info"}},[e._v(e._s(t.bridgeType))])],1)})],2)]),e._v(" "),n("el-tab-pane",{attrs:{label:"构件目录树: "+e.selectedUnitName,name:"config"}},[n("el-row",{attrs:{gutter:24}},[n("el-col",{attrs:{span:11}},[n("el-card",[n("div",[n("div",{attrs:{slot:"header"},slot:"header"},[n("span",[e._v("构件目录树")]),e._v(" "),n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:e.loading},on:{click:e.handleSaveData}},[e._v("\n                  保存配置\n                ")]),e._v(" "),n("el-button",{staticStyle:{float:"right",padding:"3px 0",color:"red","margin-right":"15px"},attrs:{type:"text",loading:e.loading},on:{click:e.handleBatchDeleteNode}},[e._v("\n                  批量删除\n                ")]),e._v(" "),n("el-button",{staticStyle:{float:"right",padding:"3px 0",color:"#ff9c06","margin-right":"15px"},attrs:{type:"text",loading:e.loading},on:{click:e.handleBatchAddNode}},[e._v("\n                  批量添加\n                ")])],1),e._v(" "),n("el-tree",{ref:"componentTree",staticClass:"box-card",attrs:{"show-checkbox":"","node-key":"id","highlight-current":!0,data:e.formData,"default-expand-all":!0,"expand-on-click-node":!1,"render-content":e.renderContent},on:{"node-click":e.handleTreeNodeClick}})],1)])],1),e._v(" "),n("el-col",{attrs:{span:13}},[n("el-card",{staticClass:"config-card"},[n("div",{attrs:{slot:"header"},slot:"header"},[n("span",[e._v("当前配置部件:\n                "),e._l(e.selectedNodePathOfPart,function(t,a){return n("span",{key:t.id,staticStyle:{color:"#666"}},[a>0?n("span",{staticStyle:{color:"#ccc"}},[e._v(" / ")]):e._e(),e._v(e._s(t.label)+"\n                ")])})],2)]),e._v(" "),n("el-row",{attrs:{gutter:24}},[n("el-col",{attrs:{span:8}},[n("p",[e._v("模板字符串：")]),e._v(" "),n("p",[n("el-input",{attrs:{placeholder:"如：第1跨/0#墩台"},model:{value:e.bigComponentTemplate,callback:function(t){e.bigComponentTemplate=t},expression:"bigComponentTemplate"}})],1),e._v(" "),n("p",[n("el-button",{attrs:{type:"primary"},on:{click:e.handleBigComponentDone}},[e._v("添加构件大类")])],1)]),e._v(" "),n("el-col",{attrs:{span:8}},[n("p",[e._v("起始编号：")]),e._v(" "),n("p",[n("el-input",{attrs:{type:"number",placeholder:"请输入"},model:{value:e.bigComponentNumberStart,callback:function(t){e.bigComponentNumberStart=t},expression:"bigComponentNumberStart"}})],1)]),e._v(" "),n("el-col",{attrs:{span:8}},[n("p",[e._v("构件大类数量：")]),e._v(" "),n("p",[n("el-input",{attrs:{type:"number",placeholder:"请输入数量"},model:{value:e.bigComponentNumber,callback:function(t){e.bigComponentNumber=t},expression:"bigComponentNumber"}})],1)])],1)],1)],1),e._v(" "),n("el-col",{attrs:{span:13}},[n("el-card",{staticClass:"config-card"},[n("div",{attrs:{slot:"header"},slot:"header"},[n("span",[e._v("当前配置构件大类:\n                "),e._l(e.selectedNodePathOfBigComponent,function(t,a){return n("span",{key:t.id,staticStyle:{color:"#666"}},[a>0?n("span",{staticStyle:{color:"#ccc"}},[e._v(" / ")]):e._e(),e._v(e._s(t.label)+"("+e._s(t.id)+")\n                ")])})],2)]),e._v(" "),n("el-row",{attrs:{gutter:24}},[n("el-col",{attrs:{span:8}},[n("p",[e._v("构件名称：")]),e._v(" "),n("p",[n("el-select",{attrs:{filterable:"","allow-create":"",placeholder:"请选择或输入"},model:{value:e.valueComponentType,callback:function(t){e.valueComponentType=t},expression:"valueComponentType"}},e._l(e.componentType,function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),n("p",[n("el-button",{attrs:{type:"primary"},on:{click:e.handleComponentDone}},[e._v("添加构件")])],1)]),e._v(" "),n("el-col",{attrs:{span:8}},[n("p",[e._v("起始编号：")]),e._v(" "),n("p",[n("el-input",{attrs:{type:"number",placeholder:"请输入"},model:{value:e.componentNumberStart,callback:function(t){e.componentNumberStart=t},expression:"componentNumberStart"}})],1)]),e._v(" "),n("el-col",{attrs:{span:8}},[n("p",[e._v("构件数量：")]),e._v(" "),n("p",[n("el-input",{attrs:{type:"number",placeholder:"构件数",disabled:!e.valueComponentType},model:{value:e.valueComponentNumber,callback:function(t){e.valueComponentNumber=t},expression:"valueComponentNumber"}})],1)])],1)],1)],1)],1)],1)],1)],1)},r=[],i={render:a,staticRenderFns:r};t.a=i}});