webpackJsonp([3],{"0sgL":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("el-row",{attrs:{gutter:24}},[i("el-col",{attrs:{span:5}},[i("ComponentTree",{attrs:{bridge:e.bridge},on:{handleNodeClick:e.handleNodeClick,handleChangeUnit:e.handleChangeUnit}})],1),e._v(" "),i("el-col",{attrs:{span:19}},[i("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[i("el-tab-pane",{attrs:{label:e.isShowHistoryCheckDisease?"历史检查结果详情":"当前检查结果",name:"current"}},[i("el-row",{attrs:{gutter:24}},[i("el-col",{attrs:{span:24}},[i("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:24}},[i("el-col",{attrs:{span:6}},[i("el-input",{attrs:{placeholder:"构件名称"}})],1),e._v(" "),i("el-col",{attrs:{span:18}},[e.isShowHistoryCheckDisease?e._e():i("el-button",{attrs:{loading:e.loading,icon:"el-icon-search"},on:{click:e.queryCheckDiseases}},[e._v("搜索")]),e._v(" "),e.isShowHistoryCheckDisease?i("el-button",{attrs:{loading:e.loading,icon:"el-icon-back"},on:{click:e.handleBackToCurrentDisease}},[e._v("返回")]):e._e(),e._v(" "),e.isShowHistoryCheckDisease?e._e():i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.onCurrentCheckOpen("create")}}},[e._v("添加")]),e._v(" "),i("el-button",{attrs:{type:"warning",icon:"el-icon-download"},on:{click:e.handleExportCurrentCheck}},[e._v("导出excel")]),e._v(" "),e.isShowHistoryCheckDisease?e._e():i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"info",icon:"el-icon-check",disabled:!e.diseases.length},on:{click:e.handleSubmitCheckDiseasesOpen}},[e._v("提交")])],1)],1),e._v(" "),i("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:24}},e._l(e.inputForm,function(t){return i("el-col",{key:t.key,attrs:{span:5}},[i("el-input",{attrs:{placeholder:"",readonly:""},model:{value:e.inputFormData[t.key],callback:function(i){e.$set(e.inputFormData,t.key,i)},expression:"inputFormData[item.key]"}},[i("template",{slot:"prepend"},[e._v(e._s(t.label))])],2)],1)})),e._v(" "),i("el-table",{attrs:{data:e.diseases,width:"100%","element-loading-text":"给我一点时间",border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{align:"center",label:"序号",width:"65",type:"index"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"80",align:"center",label:"部件名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.partName))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"80",align:"center",label:"缺损构件"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.defectiveComponent))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"80",align:"center",label:"缺损类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.defectiveType))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"80",align:"center",label:"缺损描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.defectiveDescription))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"80",align:"center",label:"照片附件"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.photoAttachments?i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){e.previewPhotoAttachment(t.row.photoAttachments)}}},[e._v("查看照片")]):i("span",[e._v("暂无照片")])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"95",align:"center",label:"处理紧迫度"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.degreeOfUrgency))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"处理建议","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.treatmentRecommendation))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作",width:"80",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text"},on:{click:function(i){e.onCurrentCheckOpen("update",t.row)}}},[i("i",{staticClass:"el-icon-edit"})]),e._v(" "),i("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(i){e.onCurrentCheckDel(t.row)}}},[i("i",{staticClass:"el-icon-delete"})])]}}])})],1)],1)],1)],1),e._v(" "),i("el-tab-pane",{attrs:{label:"历史检查结果",name:"history"}},[i("el-row",{attrs:{gutter:24}},[i("el-col",{attrs:{span:24}},[i("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:24}},[i("el-col",{attrs:{span:6}},[i("el-input",{attrs:{placeholder:"处治紧迫度"}})],1),e._v(" "),i("el-col",{attrs:{span:14}},[i("el-button",{attrs:{icon:"el-icon-search",loading:e.loading},on:{click:e.queryHistoryCheckDiseases}},[e._v("搜索")]),e._v(" "),i("el-button",{attrs:{type:"warning",icon:"el-icon-download"},on:{click:e.handleExportHistoryCheck}},[e._v("导出excel")])],1)],1),e._v(" "),i("el-table",{attrs:{width:"100%",data:e.dailyHistoryDiseases,"element-loading-text":"给我一点时间",border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{align:"center",label:"序号",width:"65",type:"index"}}),e._v(" "),i("el-table-column",{attrs:{"min-width":"100",align:"center",label:"负责人"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.checkPerson))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"80",align:"center",label:"天气"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.weather))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"100",align:"center",label:"检查日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.checkDate))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"100",align:"center",label:"缺损状况"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.defectStatus))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"100",align:"center",label:"是否上报"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.isReport))])]}}])}),e._v(" "),i("el-table-column",{attrs:{"min-width":"100",align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text"},on:{click:function(i){e.handleLookBackHistoryDisease(t.row.id)}}},[e._v("查看")]),e._v(" "),i("el-button",{attrs:{type:"text"},on:{click:function(i){e.onHistoryCheckOpen(t.row)}}},[i("i",{staticClass:"el-icon-edit"})]),e._v(" "),i("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(i){e.onHistoryCheckDel(t.row)}}},[i("i",{staticClass:"el-icon-delete"})])]}}])})],1)],1)],1)],1)],1),e._v(" "),i("el-dialog",{attrs:{width:"60vw",title:e.dialogTitleMap[e.dialogStatus],visible:e.currentDialogVisible},on:{"update:visible":function(t){e.currentDialogVisible=t}}},[i("el-form",{attrs:{model:e.currentCheckFormData,"label-width":"100px",inline:""}},e._l(e.currentCheckForm,function(t){return i("el-col",{key:t.key,attrs:{span:12}},[i("el-form-item",{attrs:{label:t.label,prop:t.key,rules:[{required:!!t.required}]}},[t.type?e._e():i("el-input",{model:{value:e.currentCheckFormData[t.key],callback:function(i){e.$set(e.currentCheckFormData,t.key,i)},expression:"currentCheckFormData[item.key]"}}),e._v(" "),"select"===t.type&&t.options?i("el-select",{attrs:{filterable:"","allow-create":""},model:{value:e.currentCheckFormData[t.key],callback:function(i){e.$set(e.currentCheckFormData,t.key,i)},expression:"currentCheckFormData[item.key]"}},e._l(t.options,function(t){return i("el-option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.value))])})):e._e(),e._v(" "),"date"===t.type?i("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",editable:""},model:{value:e.currentCheckFormData[t.key],callback:function(i){e.$set(e.currentCheckFormData,t.key,i)},expression:"currentCheckFormData[item.key]"}}):e._e(),e._v(" "),"file"===t.type?i("el-upload",{attrs:{limit:3,"on-exceed":e.handleExceed,"file-list":e.fileList,action:"/api/resource/upload","on-remove":e.handleFileRemove,"on-success":e.handleUploadFileSuccess}},[i("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-upload"}},[e._v("上传文件")])],1):e._e()],1)],1)})),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.currentDialogVisible=!1}}},[e._v("取消")]),e._v(" "),"create"==e.dialogStatus?i("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.onCurrentCheckAdd}},[e._v("确定")]):i("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.onCurrentCheckUpdate}},[e._v("确定")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"照片预览",visible:e.currentPhotoDialogVisible},on:{"update:visible":function(t){e.currentPhotoDialogVisible=t},close:e.previewPhotoAttachmentClose}},[0===!e.selectedPhotoAttachmentOptions.length?i("p",[e._v("没有上传照片附件")]):e._l(e.selectedPhotoAttachmentOptions,function(e){return i("img",{key:e.photoAttachment,staticStyle:{width:"100%"},attrs:{src:e.photoAttachment}})})],2),e._v(" "),i("el-dialog",{attrs:{width:"40vw",title:"提交当前检查结果",visible:e.historyDiseaseDialogVisible},on:{"update:visible":function(t){e.historyDiseaseDialogVisible=t}}},[i("el-form",{attrs:{model:e.historyDiseaseFormData,"label-width":"100px",inline:""}},e._l(e.historyDiseaseFormStructure,function(t){return i("el-col",{key:t.key,attrs:{span:24}},[i("el-form-item",{attrs:{label:t.label,prop:t.key,rules:[{required:!!t.required}]}},[t.type?e._e():i("el-input",{model:{value:e.historyDiseaseFormData[t.key],callback:function(i){e.$set(e.historyDiseaseFormData,t.key,i)},expression:"historyDiseaseFormData[item.key]"}}),e._v(" "),"select"===t.type&&t.options?i("el-select",{attrs:{filterable:"","allow-create":""},model:{value:e.historyDiseaseFormData[t.key],callback:function(i){e.$set(e.historyDiseaseFormData,t.key,i)},expression:"historyDiseaseFormData[item.key]"}},e._l(t.options,function(t){return i("el-option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.value))])})):e._e(),e._v(" "),"date"===t.type?i("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",editable:""},model:{value:e.historyDiseaseFormData[t.key],callback:function(i){e.$set(e.historyDiseaseFormData,t.key,i)},expression:"historyDiseaseFormData[item.key]"}}):e._e()],1)],1)})),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.historyDiseaseDialogVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.handleSubmitCheckDiseases}},[e._v("确定")])],1)],1),e._v(" "),i("el-dialog",{attrs:{width:"40vw",title:"历史检查结果",visible:e.historyDialogVisible},on:{"update:visible":function(t){e.historyDialogVisible=t}}},[i("el-form",{attrs:{model:e.historyCheckFormData,"label-width":"100px",inline:""}},e._l(e.historyDiseaseFormStructure,function(t){return i("el-col",{key:t.key,attrs:{span:24}},[i("el-form-item",{attrs:{label:t.label,prop:t.key,rules:[{required:!!t.required}]}},[t.type?e._e():i("el-input",{model:{value:e.historyCheckFormData[t.key],callback:function(i){e.$set(e.historyCheckFormData,t.key,i)},expression:"historyCheckFormData[item.key]"}}),e._v(" "),"select"===t.type&&t.options?i("el-select",{attrs:{filterable:"","allow-create":""},model:{value:e.historyCheckFormData[t.key],callback:function(i){e.$set(e.historyCheckFormData,t.key,i)},expression:"historyCheckFormData[item.key]"}},e._l(t.options,function(t){return i("el-option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.value))])})):e._e(),e._v(" "),"date"===t.type?i("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",editable:""},model:{value:e.historyCheckFormData[t.key],callback:function(i){e.$set(e.historyCheckFormData,t.key,i)},expression:"historyCheckFormData[item.key]"}}):e._e()],1)],1)})),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.historyDialogVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.onHistoryCheckUpdate}},[e._v("确定")])],1)],1)],1)],1)],1)},n=[],o={render:a,staticRenderFns:n};t.a=o},"2wNd":function(e,t,i){"use strict";function a(e){i("6pTJ")}var n=i("ewga"),o=i("iknZ"),s=i("VU/8"),r=a,c=s(n.a,o.a,r,"data-v-05300175",null);t.a=c.exports},"6pTJ":function(e,t,i){var a=i("C44t");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);i("rjj0")("0fb9c1f9",a,!0)},C44t:function(e,t,i){t=e.exports=i("FZ+f")(!1),t.push([e.i,".box-card[data-v-05300175]{max-height:580px;overflow-x:hidden}",""])},H3dp:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("lvbp"),n=i("0sgL"),o=i("VU/8"),s=o(a.a,n.a,null,null,null);t.default=s.exports},ewga:function(e,t,i){"use strict";var a=i("Dd8w"),n=i.n(a),o=i("NYxO"),s=i("0xDb");t.a={name:"ComponentTree",props:{bridge:{type:Object},isPopupOnNonComponent:{type:Boolean,default:!1}},data:function(){return{fullHeight:"",selectedUnit:"主桥单元",constructTreeData:[],approachBridgeUnit:[]}},mounted:function(){this.fullHeight=""+document.documentElement.clientHeight,window.onresize=function(){this.clientHeight=""+document.documentElement.clientHeight}},computed:n()({},i.i(o.b)(["constructTree"])),watch:{bridge:function(e){e.id&&this.queryConstructTree(e).then(function(){}).catch(function(e){})},clientHeight:function(){this.changeFixed(this.fullHeight)},constructTree:function(){var e=this.constructTree,t=e.main,a=e.approaches;this.constructTreeData=i.i(s.c)(t),this.approachBridgeUnit=a.map(function(e,t){return{value:"引桥单元N"+(t+1)}})},constructTreeData:function(e){this.$emit("onConstructTreeDataChange",e)}},methods:n()({},i.i(o.c)(["queryConstructTree"]),{changeFixed:function(e){console.log(e),this.$refs.homePage.style.height=e+"px"},handleNodeClick:function(e,t){var a=e.id,n=this.isPopupOnNonComponent;if(i.i(s.g)(a)){var o=e,r=t.parent,c=r.data,l=void 0,h=void 0;if(i.i(s.f)(c.id))l={id:"",label:""},h=c;else{for(;!i.i(s.m)(c.id);)r=r.parent,c=r.data;for(l=c;!i.i(s.f)(c.id);)r=r.parent,c=r.data;h=c}for(;!i.i(s.e)(c.id);)r=r.parent,c=r.data;var u=c;this.$emit("handleNodeClick",{selectedComponent:o,selectedBigComponent:l,selectedPart:h,selectedPartOf:u})}else n&&this.$emit("handleNodeClick",{selectedComponent:e,isNotComponent:!0})},handleChangeUnit:function(){var e=this.constructTree,t=e.main,a=e.approaches,n=e.approachTypes,o=this.selectedUnit,r=null;if("主桥单元"===o)this.constructTreeData=i.i(s.c)(t);else{var c=parseInt(o.replace("引桥单元N",""))-1;r=n[c]||{},this.constructTreeData=i.i(s.c)(a[c])}this.$emit("handleChangeUnit",{selectedUnit:o,approachType:r})}})}},iknZ:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-tabs",{attrs:{type:"border-card"}},[i("el-tab-pane",{ref:"homePage",staticClass:"box-card",attrs:{label:"构件目录树"}},[i("div",{staticStyle:{margin:"10px 0"}},[i("el-select",{on:{change:e.handleChangeUnit},model:{value:e.selectedUnit,callback:function(t){e.selectedUnit=t},expression:"selectedUnit"}},[i("el-option",{attrs:{value:"主桥单元"}},[e._v("主桥单元")]),e._v(" "),e._l(e.approachBridgeUnit,function(t){return i("el-option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.value))])})],2)],1),e._v(" "),i("el-tree",{attrs:{"default-expand-all":"","node-key":"id","expand-on-click-node":!1,"highlight-current":!0,data:e.constructTreeData},on:{"node-click":e.handleNodeClick}})],1)],1)},n=[],o={render:a,staticRenderFns:n};t.a=o},lvbp:function(e,t,i){"use strict";var a=i("+6Bu"),n=i.n(a),o=i("woOf"),s=i.n(o),r=i("Dd8w"),c=i.n(r),l=i("NYxO"),h=i("0xDb"),u=i("2wNd"),d=[{label:"部件名称",key:"partName"},{label:"缺损构件",key:"defectiveComponent"},{label:"构件编号",key:"componentNo"},{label:"缺损类型",key:"defectiveType",type:"select",options:[{value:"桥路连接处异常"},{value:"桥面铺装明显破损"},{value:"伸缩缝明显破损"},{value:"栏杆明显破损"},{value:"护栏明显破损"},{value:"标志标牌缺损"},{value:"桥梁线形明显异常"}]},{label:"缺损描述",key:"defectiveDescription"},{label:"照片附件",key:"photoAttachments",type:"file"},{label:"处理紧迫度",key:"degreeOfUrgency",type:"select",options:[{value:"紧急"},{value:"一般"}]},{label:"处理建议",key:"treatmentRecommendation",type:"select",options:[{value:"修复"},{value:"更换"},{value:"进一步检测"}]}],p={id:0,partName:"",defectiveComponent:"",componentNo:"",defectiveType:"",defectiveDescription:"",photoAttachments:"",photoNo:"",degreeOfUrgency:"一般",treatmentRecommendation:"进一步检测"},y=[{label:"检查时间",key:"checkDate"},{label:"有无缺损",key:"defectStatus"},{label:"检查人员",key:"checkPerson"},{label:"天气",key:"weather"}],f={checkDate:"",defectStatus:"无",checkPerson:"",weather:""},m=[{label:"负责人",key:"checkPerson"},{label:"天气",key:"weather"},{label:"检查日期",key:"checkDate",type:"date"},{label:"缺损状况",key:"defectStatus",type:"select",options:[{value:"有"},{value:"无"}]},{label:"是否上报",key:"isReport",type:"select",options:[{value:"是"},{value:"否"}]}],k={id:0,checkPerson:"",weather:"",checkDate:"",defectStatus:"无",isReport:"是"};t.a={components:{ComponentTree:u.a},data:function(){return{bridge:{},dialogStatus:"create",loading:!1,activeTab:"current",dialogTitleMap:{update:"编辑",create:"创建"},fileList:[],inputForm:y,inputFormData:i.i(h.c)(f),isShowHistoryCheckDisease:!1,formData:{},diseases:[],diseasesBackup:[],historyDiseases:[],currentDialogVisible:!1,currentPhotoDialogVisible:!1,currentCheckFormData:i.i(h.c)(p),currentCheckForm:d,selectedPhotoAttachmentOptions:[],historyDialogVisible:!1,historyDiseaseDialogVisible:!1,historyDiseaseFormStructure:m,historyCheckFormData:i.i(h.c)(k),historyDiseaseFormData:i.i(h.c)(k),historyDiseaseId:1}},computed:c()({},i.i(l.b)(["constructTree","menus","selectedBridge","dailyInspection","dailyDiseases","dailyHistoryDiseases","dailyHistoryCheckDiseases","loginUser"])),mounted:function(){if(!this.$route.query.id&&!this.selectedBridge.id)return void i.i(h.d)("未选择桥梁，无法进行操作！",{type:"error"});var e=this.selectedBridge;e.id&&(this.bridge=e,this.query())},watch:{menus:function(){var e=this;if(!this.bridge.id){var t=this.$route.query.id;this.menus.forEach(function(i){var a=i.children.filter(function(e){return e.id===parseInt(t)});a.length&&(e.bridge=a[0],e.selectBridge(e.bridge),e.query())})}},dailyInspection:function(){this.formData.id||(this.formData=i.i(h.c)(this.dailyInspection))},dailyDiseases:function(){this.filterDiseases()},activeTab:function(e){"history"===e&&this.queryHistoryCheckDiseases()}},methods:c()({},i.i(l.c)(["selectBridge","queryDailyInspection","queryDailyDiseases","queryDailyHistoryDiseases","queryDailyHistoryCheckDisease","createDailyInspection","createDailyDisease","updateDailyInspection","updateDailyDisease","updateDailyHistoryCheckDisease","deleteDailyDisease","deleteDailyHistoryDisease","deleteDailyHistoryCheckDisease","submitDailyInpsectionDiseases"]),{query:function(){var e=this;this.queryDailyInspection(this.bridge).then(function(){e.queryCheckDiseases()}).catch(function(t){if(!e.formData.id&&t&&t.response&&t.response.status){var i=t.response.status,a=e.bridge;switch(i){case 404:e.createDailyInspection({bridge:a});break;default:console.log(t)}}})},queryCheckDiseases:function(){var e=this;this.loading=!0,this.queryDailyDiseases().then(function(){e.filterDiseases(),e.loading=!1,e.isShowHistoryCheckDisease=!1}).catch(function(t){i.i(h.d)("查询失败！",{type:"error"}),e.loading=!1})},queryHistoryCheckDiseases:function(){var e=this;this.loading=!0,this.queryDailyHistoryDiseases().then(function(){e.loading=!1}).catch(function(t){e.loading=!1})},filterDiseases:function(e){var t=e||"主桥单元",i="M-";0===t.indexOf("引桥单元")&&(i=t.replace("引桥单元","")+"-"),this.diseases=this.dailyDiseases.filter(function(e){return e.componentNo&&0===e.componentNo.indexOf(i)}),this.handleCurrentCheckInputData()},handleChangeUnit:function(e){var t=e.selectedUnit;this.filterDiseases(t)},handleCurrentCheckInputData:function(){var e=this.diseases;0===e.length&&(this.inputFormData=i.i(h.c)(f));for(var t=0;t<e.length;t++){var a=e[t];a.checkDate&&(this.inputFormData.checkDate=a.checkDate),a.checkPerson&&(this.inputFormData.checkPerson=a.checkPerson),a.checkWeather&&(this.inputFormDatahis.weather=a.checkWeather),a.defectStatus&&(this.inputFormData.defectStatus=a.defectStatus,"无"===this.inputFormData.defectStatus&&(this.diseases=[]))}},onCurrentCheckOpen:function(e,t){if(this.fileList=[],this.currentDialogVisible=!0,this.dialogStatus=e,"create"===e){var a=this.currentCheckFormData,n=a.partName,o=a.componentNo,r=a.defectiveComponent;this.currentCheckFormData=c()({},i.i(h.c)(p),{partName:n,componentNo:o,defectiveComponent:r})}else if("update"===e){this.currentCheckFormData=s()({},t);var l=this.currentCheckFormData.photoAttachments;this.previewPhotoAttachment(l,!0)}},onCurrentCheckAdd:function(){var e=this,t=this.currentCheckFormData;if(!t.componentNo)return void i.i(h.d)("请选择检查构件",{type:"warning"});this.loading=!0,this.createDailyDisease(t).then(function(){e.loading=!1,e.currentDialogVisible=!1,i.i(h.d)(),e.queryCheckDiseases()}).catch(function(t){e.loading=!1,i.i(h.d)("",{type:"error"})})},onCurrentCheckUpdate:function(){var e=this;this.loading=!0,this.updateDailyDisease(this.currentCheckFormData).then(function(){e.loading=!1,e.currentDialogVisible=!1,i.i(h.d)("更新成功!",{type:"success"}),e.isShowHistoryCheckDisease?e.handleLookBackHistoryDisease(e.historyDiseaseId):e.queryCheckDiseases()}).catch(function(t){e.loading=!1,i.i(h.d)("更新失败!",{type:"error"})})},onCurrentCheckDel:function(e){var t=this;this.isShowHistoryCheckDisease?this.onHistoryCheckDiseaseDel(e):this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return t.deleteDailyDisease(e).then(function(){i.i(h.d)("删除成功!",{type:"success"}),t.queryCheckDiseases()}).catch(function(e){i.i(h.d)("删除失败!",{type:"error"})})}).catch(function(){i.i(h.d)("取消删除!",{type:"info"})})},handleUploadFileSuccess:function(e,t,i){e&&e.length&&(this.currentCheckFormData.photoAttachments&&(this.currentCheckFormData.photoAttachments+=","),this.currentCheckFormData.photoAttachments+=e[0])},handleFileRemove:function(e){var t=this.currentCheckFormData.photoAttachments,i=t.replace(e.name+",","");if(i!==t)this.currentCheckFormData.photoAttachments=i;else{var a=t.replace(e.name,"");this.currentCheckFormData.photoAttachments=a}},handleExceed:function(e,t){i.i(h.d)("最多可上传3张照片",{type:"warning"})},previewPhotoAttachment:function(e,t){if(t||(this.currentPhotoDialogVisible=!0),e){this.selectedPhotoAttachmentOptions=[],this.fileList=[];var i=e.indexOf(":")>-1,a=e.split(",");if(!i)for(var n=0;n<a.length;n++)if(a[n]){var o="/api/resource/download/"+a[n],s={name:a[n],photoAttachment:o};this.selectedPhotoAttachmentOptions.push(s),this.fileList.push(s)}}},previewPhotoAttachmentClose:function(){this.selectedPhotoAttachmentOptions=[]},handleExportCurrentCheck:function(){var e=this;this.$confirm("您确定要导出Excel吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){e.exportCurrentCheck(),i.i(h.d)("已成功导出Excel!",{type:"success"})}).catch(function(){i.i(h.d)("已取消!",{type:"info"})})},exportCurrentCheck:function(){var e=this;Promise.all([i.e(36),i.e(35)]).then(function(){var t=i("zWO4"),a=t.export_json_to_excel,n=["序号","部件名称","缺损构件","缺损类型","缺损描述","照片附件","照片编号","处治紧迫度","处治建议"],o=["id","partName","defectiveComponent","defectiveType","defectiveDescription","photoAttachments","photoNo","degreeOfUrgency","treatmentRecommendation"];a(n,i.i(h.h)(o,e.diseases),"日常检查-"+(e.isShowHistoryCheckDisease?"历史检查结果":"当前检查结果"))}.bind(null,i)).catch(i.oe)},handleSubmitCheckDiseasesOpen:function(){var e=this.inputFormData,t=e.weather,i=e.checkDate,a=e.checkPerson,n=e.defectStatus,o={checkPerson:a,checkDate:i,weather:t,defectStatus:"有"===n?"有":"无",isReport:"是"};this.historyDiseaseFormData=o,this.historyDiseaseDialogVisible=!0},handleSubmitCheckDiseases:function(){var e=this;this.$confirm("您确定要提交所有当前检查结果吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){e.submitDailyInpsectionDiseases(e.historyDiseaseFormData).then(function(){e.queryCheckDiseases(),i.i(h.d)(),e.historyDiseaseDialogVisible=!1}).catch(function(e){i.i(h.d)("检查结果提交失败",{type:"error"})})}).catch(function(){i.i(h.d)("已取消!",{type:"info"})})},handleLookBackHistoryDisease:function(e){var t=this;this.historyDiseaseId=e,e&&this.queryDailyHistoryCheckDisease({id:e}).then(function(){!1===t.isShowHistoryCheckDisease&&(t.diseasesBackup=t.diseases,t.isShowHistoryCheckDisease=!0),t.diseases=t.dailyHistoryCheckDiseases,t.activeTab="current",t.handleCurrentCheckInputData()}).catch(function(e){i.i(h.d)("查询历史结果病害列表失败",{type:"error"})})},handleBackToCurrentDisease:function(){this.isShowHistoryCheckDisease=!1,this.diseases=this.diseasesBackup,this.handleCurrentCheckInputData(),this.diseasesBackup=[]},onHistoryCheckOpen:function(e){this.historyDialogVisible=!0,this.historyCheckFormData=s()({},e)},onHistoryCheckUpdate:function(){var e=this;this.loading=!0,this.updateDailyHistoryCheckDisease(this.historyCheckFormData).then(function(){e.loading=!1,e.historyDialogVisible=!1,i.i(h.d)("更新成功!",{type:"success"}),e.queryDailyHistoryDiseases()}).catch(function(t){e.loading=!1,i.i(h.d)("更新失败!",{type:"error"})})},onHistoryCheckDiseaseDel:function(e){var t=this,a=this.historyDiseaseId,n={diseaseId:e.id,historyDiseaseId:a};this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return t.deleteDailyHistoryCheckDisease(n).then(function(){i.i(h.d)("删除成功!",{type:"success"}),t.handleLookBackHistoryDisease(a)}).catch(function(e){i.i(h.d)("删除失败!",{type:"error"})})}).catch(function(){i.i(h.d)("取消删除!",{type:"info"})})},onHistoryCheckDel:function(e){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return t.deleteDailyHistoryDisease(e).then(function(){i.i(h.d)("删除成功!",{type:"success"}),t.queryHistoryCheckDiseases()}).catch(function(e){i.i(h.d)("删除失败!",{type:"error"})})}).catch(function(){i.i(h.d)("取消删除!",{type:"info"})})},handleExportHistoryCheck:function(){var e=this;this.$confirm("您确定要导出Excel吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){e.exportHistoryCheck()}).catch(function(){i.i(h.d)("已取消!",{type:"info"})})},exportHistoryCheck:function(){var e=this;Promise.all([i.e(36),i.e(35)]).then(function(){var t=i("zWO4"),a=t.export_json_to_excel,n=["序号","负责人","天气","检查日期","缺损状况","是否上报"],o=["id","checkPerson","weather","checkDate","defectStatus","isReport"];a(n,i.i(h.h)(o,e.dailyHistoryDiseases),"日常检查-历史检查结果")}.bind(null,i)).catch(i.oe)},handleNodeClick:function(e){var t=e.selectedPart,i=e.selectedComponent,a=n()(this.currentCheckFormData,[]);this.currentCheckFormData=c()({},a,{partName:t.label,defectiveComponent:i.label,componentNo:i.id}),this.onCurrentCheckOpen("create")}})}}});