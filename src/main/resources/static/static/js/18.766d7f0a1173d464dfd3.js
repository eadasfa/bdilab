webpackJsonp([18],{"7WsN":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container",attrs:{type:"border-card"}},[i("el-tabs",{attrs:{type:"border-card"}},[i("el-tab-pane",{attrs:{label:"工程量确认"}},[i("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:24}},[i("el-col",{attrs:{span:3}},[i("el-select",{on:{change:e.handleChangeUnit},model:{value:e.selectedUnit,callback:function(t){e.selectedUnit=t},expression:"selectedUnit"}},[i("el-option",{attrs:{value:"主桥单元"}},[e._v("主桥单元")]),e._v(" "),e._l(e.approachBridgeUnit,function(t){return i("el-option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.value))])})],2)],1),e._v(" "),i("el-col",{attrs:{span:4}},[i("el-select",{staticStyle:{width:"100%"},on:{change:e.handleChangeCheckItem},model:{value:e.selectedCheckItem,callback:function(t){e.selectedCheckItem=t},expression:"selectedCheckItem"}},[i("el-option",{attrs:{value:"当前检查结果"}},[e._v("当前检查结果")]),e._v(" "),e._l(e.periodHistoryDiseases,function(t){return i("el-option",{key:t.id,attrs:{value:t.id}},[e._v("历史检查结果: "+e._s(t.checkDate)+" ("+e._s(t.checkUnit)+")")])})],2)],1),e._v(" "),i("el-col",{attrs:{span:4}},[i("el-button",{attrs:{icon:"el-icon-search",loading:e.loading},on:{click:e.query}},[e._v("搜索")])],1)],1),e._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[i("el-table-column",{attrs:{label:"序号",width:"80",align:"center",type:"index"}}),e._v(" "),i("el-table-column",{attrs:{prop:"maintenanceMeasure",label:"措施/位置","min-width":"150",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"engineeringUnit",label:"单位","min-width":"75",align:"center"}}),e._v(" "),e._l(e.tableHeadData,function(t){return i("el-table-column",{key:t.value,attrs:{prop:t.value,label:t.label,align:"center"}},e._l(t.children,function(e){return i("el-table-column",{key:e.id,attrs:{prop:e.label,label:e.label,align:"center"}})}))}),e._v(" "),i("el-table-column",{attrs:{prop:"other",label:"其他","min-width":"80",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"total",label:"合计","min-width":"100",align:"center",fixed:"right"}})],2)],1)],1)],1)},n=[],r={render:a,staticRenderFns:n};t.a=r},bNxD:function(e,t,i){var a=i("pyVd");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);i("rjj0")("ba6b3f6a",a,!0)},cS12:function(e,t,i){"use strict";function a(e){i("bNxD")}Object.defineProperty(t,"__esModule",{value:!0});var n=i("iYiU"),r=i("7WsN"),s=i("VU/8"),c=a,l=s(n.a,r.a,c,null,null);t.default=l.exports},iYiU:function(e,t,i){"use strict";var a=i("woOf"),n=i.n(a),r=i("Dd8w"),s=i.n(r),c=i("NYxO"),l=i("0xDb");t.a={data:function(){return{loading:!1,bridge:{},selectedUnit:"主桥单元",selectedCheckItem:"当前检查结果",bridgeType:"",approachBridgeUnit:[],constructTreeData:[],tableData:[],tableDataMap:{},tableHeadData:[],maintainMethodList:[],diseases:[]}},mounted:function(){if(!this.$route.query.id&&!this.selectedBridge.id)return void i.i(l.d)("未选择桥梁，无法进行操作！",{type:"error"});this.selectedBridge.id&&(this.bridge=this.selectedBridge,this.query())},computed:s()({},i.i(c.b)(["selectedBridge","constructTree","menus","constructTreeMainBridgeType","periodDiseases","periodHistoryDiseases","periodHistoryCheckDiseases"])),watch:{constructTree:function(){var e=this.constructTree,t=e.main,a=e.approaches;this.constructTreeData=i.i(l.c)(t),this.approachBridgeUnit=a.map(function(e,t){return{value:"引桥单元N"+(t+1)}})},menus:function(){var e=this;if(!this.bridge.id){var t=this.$route.query.id;this.menus.forEach(function(i){var a=i.children.filter(function(e){return e.id===parseInt(t)});a.length&&(e.bridge=a[0],e.selectBridge(e.bridge),e.query())})}},constructTreeMainBridgeType:function(e){this.bridgeType=e}},methods:s()({},i.i(c.c)(["selectBridge","queryConstructTree","queryPeriodInspection","queryPeriodDiseases","queryPeriodHistoryDiseases","queryPeriodHistoryCheckDisease"]),{query:function(){var e=this,t=this.bridge;t.id&&(this.loading=!0,this.queryConstructTree(t).then(function(){return e.queryPeriodInspection(t)}).then(function(){return e.queryPeriodDiseases()}).then(function(){e.filterDiseases(),e.createTableHead(),e.createTableData()}).catch(function(e){console.log(e)}).then(function(){e.loading=!1}))},handleChangeUnit:function(){var e=this.constructTree,t=e.main,a=e.approaches,n=e.approachTypes,r=this.selectedUnit,s=null;if("主桥单元"===r)this.constructTreeData=i.i(l.c)(t);else{var c=parseInt(r.replace("引桥单元N",""))-1;s=n[c]||{},this.bridgeType=s.bridgeType,this.constructTreeData=i.i(l.c)(a[c])}this.filterDiseases(),this.createTableHead(),this.createTableData()},handleChangeCheckItem:function(e){var t=this;e&&("当前检查结果"===e?this.query():this.queryPeriodHistoryCheckDisease({id:e}).then(function(){t.filterDiseases(),t.createTableHead(),t.createTableData()}).catch(function(e){i.i(l.d)("查询历史结果病害列表失败",{type:"error"})}))},filterDiseases:function(){var e=this.selectedUnit,t=e||"主桥单元",i="M-";0===t.indexOf("引桥单元")&&(i=t.replace("引桥单元","")+"-"),"当前检查结果"===this.selectedCheckItem?this.diseases=this.periodDiseases.filter(function(e){return e.componentNo&&0===e.componentNo.indexOf(i)}):this.diseases=this.periodHistoryCheckDiseases.filter(function(e){return e.componentNo&&0===e.componentNo.indexOf(i)})},createTableHead:function(){var e=this;this.tableHeadData=[],this.constructTreeData.forEach(function(t){var i=n()({},t);e.tableHeadData.push(i)})},createTableData:function(){var e=this;this.tableData=[];var t={};this.diseases.forEach(function(e){var i=e.maintenanceMeasure;i&&(void 0===t[i]?t[i]=[e]:t[i].push(e))});for(var i in t)!function(i){var a=t[i],r={maintenanceMeasure:i,engineeringUnit:a[0].engineeringUnit,other:"/"},s=0,c={};a.forEach(function(e){var t=e.partName,i=e.engineeringQuantity,a=t.replace(/-.*/g,"");c[a]?c[a]+=parseFloat(e.engineeringQuantity):c[a]=parseFloat(e.engineeringQuantity),t&&(s+=parseFloat(i))}),r.total=""+s.toFixed(2)+a[0].engineeringUnit;var l=n()(r,c);e.tableData.push(l)}(i)}})}},pyVd:function(e,t,i){t=e.exports=i("FZ+f")(!1),t.push([e.i,"",""])}});